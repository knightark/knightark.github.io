
 <!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="UTF-8">
  
    <title>åŠˆè†æ–©æ£˜ï¼šGitlab éƒ¨ç½² CI æŒç»­é›†æˆ | ä¸ªäººåšå®¢</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="knightark">
    

    
    <meta name="description" content="åŠˆè†æ–©æ£˜ï¼šGitlab éƒ¨ç½² CI æŒç»­é›†æˆ        é˜…è¯»ç›®å½•ï¼š  install configue gitlab-ci-multi-runner restore nuget packages bulid .sln run unit tests configue .gitlab-ci.yml configue build status badge image  CI ç²¾åæ–‡ç« ï¼š">
<meta property="og:type" content="article">
<meta property="og:title" content="åŠˆè†æ–©æ£˜ï¼šGitlab éƒ¨ç½² CI æŒç»­é›†æˆ">
<meta property="og:url" content="https://knightark.github.io/2020/12/22/%E5%8A%88%E8%8D%86%E6%96%A9%E6%A3%98%EF%BC%9AGitlab%20%E9%83%A8%E7%BD%B2%20CI%20%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90/index.html">
<meta property="og:site_name" content="ä¸ªäººåšå®¢">
<meta property="og:description" content="åŠˆè†æ–©æ£˜ï¼šGitlab éƒ¨ç½² CI æŒç»­é›†æˆ        é˜…è¯»ç›®å½•ï¼š  install configue gitlab-ci-multi-runner restore nuget packages bulid .sln run unit tests configue .gitlab-ci.yml configue build status badge image  CI ç²¾åæ–‡ç« ï¼š">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://images2015.cnblogs.com/blog/435188/201605/435188-20160505145753669-139221853.png">
<meta property="og:image" content="https://images2015.cnblogs.com/blog/435188/201605/435188-20160505150155263-1919562161.png">
<meta property="og:image" content="https://images2015.cnblogs.com/blog/435188/201605/435188-20160505153302341-2007940860.png">
<meta property="og:image" content="https://images2015.cnblogs.com/blog/435188/201605/435188-20160505213235279-417659233.png">
<meta property="og:image" content="https://images2015.cnblogs.com/blog/435188/201605/435188-20160505214934794-2100519539.png">
<meta property="og:image" content="https://images2015.cnblogs.com/blog/435188/201605/435188-20160505215133466-114072506.png">
<meta property="og:image" content="https://images2015.cnblogs.com/blog/435188/201605/435188-20160505215527560-1180463408.png">
<meta property="article:published_time" content="2020-12-22T01:06:04.000Z">
<meta property="article:modified_time" content="2021-06-08T03:37:12.170Z">
<meta property="article:author" content="knightark">
<meta property="article:tag" content="blogs">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://images2015.cnblogs.com/blog/435188/201605/435188-20160505145753669-139221853.png">

    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/%02.css">
<link rel="stylesheet" href="/.css">

<meta name="generator" content="Hexo 5.4.0"></head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="ä¸ªäººåšå®¢" title="ä¸ªäººåšå®¢"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="ä¸ªäººåšå®¢">ä¸ªäººåšå®¢</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">ä¸»é¡µ</a></li>
					
						<li><a href="/archives">å½’æ¡£</a></li>
					
						<li><a href="/about">å…³äº</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search" />
						<input type="hidden" name="q" value="site:knightark.github.io">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2020/12/22/åŠˆè†æ–©æ£˜ï¼šGitlab éƒ¨ç½² CI æŒç»­é›†æˆ/" title="åŠˆè†æ–©æ£˜ï¼šGitlab éƒ¨ç½² CI æŒç»­é›†æˆ" itemprop="url">åŠˆè†æ–©æ£˜ï¼šGitlab éƒ¨ç½² CI æŒç»­é›†æˆ</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="knightark" target="_blank" itemprop="author">knightark</a>
		
  <p class="article-time">
    <time datetime="2020-12-22T01:06:04.000Z" itemprop="datePublished"> Published 2020-12-22</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">Contents</strong>
		
			<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8A%88%E8%8D%86%E6%96%A9%E6%A3%98%EF%BC%9AGitlab-%E9%83%A8%E7%BD%B2-CI-%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90"><span class="toc-number">1.</span> <span class="toc-text">     åŠˆè†æ–©æ£˜ï¼šGitlab éƒ¨ç½² CI æŒç»­é›†æˆ        </span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-install-configue-gitlab-ci-multi-runner"><span class="toc-number">1.1.</span> <span class="toc-text">1. install configue gitlab-ci-multi-runner</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-restore-nuget-packages"><span class="toc-number">1.2.</span> <span class="toc-text">2. restore nuget packages</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-build-sln"><span class="toc-number">1.3.</span> <span class="toc-text">3. build *.sln</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-run-unit-tests"><span class="toc-number">1.4.</span> <span class="toc-text">4. run unit tests</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-configue-gitlab-ci-yml"><span class="toc-number">1.5.</span> <span class="toc-text">5. configue .gitlab-ci.yml</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-configue-build-status-badge-image"><span class="toc-number">1.6.</span> <span class="toc-text">6. configue build status badge image</span></a></li></ol></li></ol>
		
		</div>
		
		<h1 id="åŠˆè†æ–©æ£˜ï¼šGitlab-éƒ¨ç½²-CI-æŒç»­é›†æˆ"><a href="#åŠˆè†æ–©æ£˜ï¼šGitlab-éƒ¨ç½²-CI-æŒç»­é›†æˆ" class="headerlink" title="     åŠˆè†æ–©æ£˜ï¼šGitlab éƒ¨ç½² CI æŒç»­é›†æˆ        "></a><a target="_blank" rel="noopener" href="https://www.cnblogs.com/xishuai/p/gitlab-ci.html">     åŠˆè†æ–©æ£˜ï¼šGitlab éƒ¨ç½² CI æŒç»­é›†æˆ        </a></h1><p>é˜…è¯»ç›®å½•ï¼š</p>
<ul>
<li><strong>install configue gitlab-ci-multi-runner</strong></li>
<li><strong>restore nuget packages</strong></li>
<li><strong>bulid .sln</strong></li>
<li><strong>run unit tests</strong></li>
<li><strong>configue .gitlab-ci.yml</strong></li>
<li><strong>configue build status badge image</strong></li>
</ul>
<p>CI ç²¾åæ–‡ç« ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2015/09/continuous-integration.html">æŒç»­é›†æˆæ˜¯ä»€ä¹ˆï¼Ÿ</a></li>
<li><a target="_blank" rel="noopener" href="http://www.cnblogs.com/davenkin/archive/2012/02/25/continuous-integration-from-martin-fowler.html">é‡æ¸©å¤§å¸ˆç»å…¸ï¼šMartin Fowler çš„æŒç»­é›†æˆ</a></li>
</ul>
<p>Gitlab éƒ¨ç½² CI ç›¸å…³èµ„æ–™ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://ruby-china.org/topics/28726">é…ç½® gitlab-ci è¿›è¡ŒæŒç»­é›†æˆ</a></li>
<li><a target="_blank" rel="noopener" href="http://answ.me/post/build-docker-images-automatically-via-gitlab-ci/">ä½¿ç”¨ GitLab-CI æ¥è‡ªåŠ¨åˆ›å»º Docker é•œåƒ</a></li>
<li><a target="_blank" rel="noopener" href="https://www.zybuluo.com/bornkiller/note/314902">åŸºäº gitlab æ­å»º CI ç¯å¢ƒ</a></li>
<li><a target="_blank" rel="noopener" href="http://archiechen.github.io/blog/2013/01/12/shi-yong-gitlab-he-gitlab_ci-jin-xing-chi-xu-ji-cheng/">ä½¿ç”¨ gitlab å’Œ gitlab_ci è¿›è¡ŒæŒç»­é›†æˆ</a></li>
</ul>
<p><strong>æŒç»­é›†æˆ</strong>ï¼ˆContinuous integration - CIï¼‰çš„ä½œç”¨ï¼šä»£ç åœ¨æäº¤åˆ°èµ„æºåº“ä¹‹å‰ï¼Œè¿›è¡Œæ„å»ºã€è‡ªåŠ¨åŒ–æµ‹è¯•å’Œå‘å¸ƒç­‰ç­‰ï¼Œæˆ‘ä»¬æ¯å¤©éœ€è¦æäº¤å¤§é‡çš„ä»£ç ï¼ŒæŒç»­é›†æˆå¯ä»¥æœ‰æ•ˆçš„å¸®åŠ©æˆ‘ä»¬å‘ç°ä»£ç ä¸­çš„ Bugï¼Œå¹¶ä¸”å‡å°‘ä¸€äº›åå¤çš„å·¥ä½œç­‰ç­‰ï¼Œä½¿å›¢é˜Ÿæ›´åŠ æœ‰æ•ˆçš„å¼€å‘åä½œã€‚</p>
<p>GitLab CI å®˜æ–¹ä»‹ç»ï¼š<a target="_blank" rel="noopener" href="https://about.gitlab.com/gitlab-ci/">https://about.gitlab.com/gitlab-ci/</a></p>
<p>Gitlab åœ¨ 8.0 ä»¥ä¸Šç‰ˆæœ¬é›†æˆäº† CIï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦å¦å¤–é…ç½®ä¸€ä¸ª gitlab-ci-server æœåŠ¡å™¨ï¼Œä¸ºæˆ‘ä»¬éƒ¨ç½²å‡å°‘äº†å¾ˆå¤šçš„å·¥ä½œï¼Œç‚¹ä¸ªèµğŸ‘ï¼</p>
<p>å…ˆåæ§½ä¸‹ï¼ŒGitlab éƒ¨ç½² CI æˆ‘å¤§æ¦‚èŠ±äº†ä¸€å‘¨çš„æ—¶é—´ï¼Œä½†ä¹Ÿåªæ˜¯è¿›è¡Œäº†ä¸€ç‚¹ç‚¹ï¼Œæœ€é‡è¦çš„ä¸‰ç‚¹ï¼š<code>nuget restore</code>, <code>bulid *.sln</code>å’Œ<code>run unit tests</code>ç°åœ¨åŸºæœ¬ä¸Šæ˜¯å¯ä»¥äº†ï¼Œåœ¨éƒ¨ç½²çš„è¿‡ç¨‹ä¸­ï¼Œæ·±æ„Ÿåˆ°é—®é¢˜åˆ†äº«çš„é‡è¦æ€§ï¼Œé‡åˆ°çš„å¤§é‡é—®é¢˜ï¼ŒGoogle åŸºæœ¬ä¸Šæœä¸åˆ°ï¼Œä¸­æ–‡ç›¸å…³èµ„æ–™ä¹Ÿå°±ä¸Šé¢çš„å‡ ç¯‡æ–‡ç« ï¼Œä½†çœ‹è¿‡ä¹‹åå‘ç°éƒ½æ˜¯ç®€ç®€å•å•çš„ä»‹ç»è€Œå·²ï¼Œå¹¶æ²¡æœ‰è®°å½•è¯¦ç»†çš„éƒ¨ç½²è¿‡ç¨‹ï¼Œæ‰€ä»¥ï¼Œæˆ‘åŸºæœ¬ä¸Šéƒ½æ˜¯çœ‹çš„  Gitlab å®˜æ–¹å¸®åŠ©æ–‡æ¡£ï¼Œä½† Gitlab  çš„æ›´æ–°å¾ˆé¢‘ç¹ï¼Œæ‰€ä»¥æœ‰äº›å¸®åŠ©æ–‡æ¡£éƒ½æ²¡è¿›è¡Œæ›´æ–°ï¼Œé¿å…ä¸äº†è¸©è¿›ä¸€äº›å‘ï¼Œé‚£æ€ä¹ˆåŠå‘¢ï¼Ÿè§£å†³æ–¹å¼å°±æ˜¯ä¸æ–­çš„è¿›è¡Œå°è¯•ï¼Œæ¯”å¦‚æˆ‘é…ç½®<code>.gitlab-ci.yml</code>æ–‡ä»¶çš„æ—¶å€™ï¼Œå°±ä¸æ–­çš„è¿›è¡Œ<code>code commit</code>æµ‹è¯•ï¼ˆä¸€ç™¾å¤šä¸ªæäº¤ğŸ˜‚ï¼‰ï¼š</p>
<p><img src="https://images2015.cnblogs.com/blog/435188/201605/435188-20160505145753669-139221853.png" alt="img"></p>
<p>å¹¶ä¸”æœ‰å…ˆè§ä¹‹æ˜çš„æŠŠé—®é¢˜è§£å†³è¿‡ç¨‹ï¼Œéƒ½ç”¨ Issue è¿›è¡Œè®°å½•äº†ğŸ˜ï¼š</p>
<p><img src="https://images2015.cnblogs.com/blog/435188/201605/435188-20160505150155263-1919562161.png" alt="img"></p>
<p>ä¸‹é¢å°±ä»ä¸Šé¢è¿™å‡ ä¸ª Issue è¿›è¡Œå±•å¼€ï¼ŒæŠŠæ¯ä¸ªé—®é¢˜å’Œè§£å†³è¿‡ç¨‹éƒ½åˆ†äº«å‡ºæ¥ï¼Œå¸Œæœ›å¯ä»¥å¸®åŠ©åˆ°é‡åˆ°ç›¸åŒé—®é¢˜çš„å›­å‹ã€‚</p>
<h2 id="1-install-configue-gitlab-ci-multi-runner"><a href="#1-install-configue-gitlab-ci-multi-runner" class="headerlink" title="1. install configue gitlab-ci-multi-runner"></a>1. install configue gitlab-ci-multi-runner</h2><p>GitLab éƒ¨ç½² CI çš„ç¬¬ä¸€æ­¥å°±æ˜¯å®‰è£… gitlab-ci-multi-runnerï¼Œä½ å¯ä»¥æŠŠå®ƒç†è§£ä¸ºï¼šè·‘ CI çš„æœåŠ¡ã€‚</p>
<p>windows å®‰è£…æ•™ç¨‹ï¼š<a target="_blank" rel="noopener" href="https://gitlab.com/gitlab-org/gitlab-ci-multi-runner/blob/master/docs/install/windows.md">https://gitlab.com/gitlab-org/gitlab-ci-multi-runner/blob/master/docs/install/windows.md</a></p>
<p>ä¸‹è½½å¥½ <a target="_blank" rel="noopener" href="https://gitlab-ci-multi-runner-downloads.s3.amazonaws.com/latest/binaries/gitlab-ci-multi-runner-windows-amd64.exe">gitlab-ci-multi-runner-windows-amd64.exe</a> å®‰è£…æ–‡ä»¶åï¼Œå°†å®‰è£…æ–‡ä»¶æ”¾åœ¨<code>C:\Multi-Runner</code>ä¸‹ï¼Œä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œå‘½ä»¤è¡Œï¼Œå¦‚æœ<code>gitlab-ci-multi-runner </code>å‘½ä»¤æ‰¾ä¸åˆ°ï¼Œç›´æ¥ç”¨<code>gitlab-ci-multi-runner-windows-amd64.exe</code>å‘½ä»¤è¿è¡Œã€‚</p>
<p>åœ¨ Gitlab é¡¹ç›®ä¸­æ‰“å¼€ <strong>Settings &gt; Runners</strong>ï¼Œæ‰¾åˆ°<code>URL</code>å’Œ<code>token</code>ï¼Œç­‰ä¼šå®‰è£…çš„æ—¶å€™éœ€è¦é…ç½®ã€‚</p>
<p>å®‰è£…é…ç½®æ­¥éª¤ï¼š</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">C:\<span class="title">WINDOWS</span>\<span class="title">system32</span>&gt;<span class="title">cd</span> <span class="title">C</span>:\<span class="title">Multi</span>-<span class="title">Runner</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">C</span>:\<span class="title">Multi</span>-<span class="title">Runner</span>&gt;<span class="title">gitlab</span>-<span class="title">ci</span>-<span class="title">multi</span>-<span class="title">runner</span>-<span class="title">windows</span>-<span class="title">amd64.exe</span> <span class="title">register</span></span></span><br><span class="line"><span class="function"><span class="title">Please</span> <span class="title">enter</span> <span class="title">the</span> <span class="title">gitlab</span>-<span class="title">ci</span> <span class="title">coordinator</span> <span class="title">URL</span> (<span class="title">e.g</span>. <span class="title">https</span>://<span class="title">gitlab.com</span>/<span class="title">ci</span>):</span></span><br><span class="line"><span class="function"><span class="title">URL</span></span></span><br><span class="line"><span class="function"><span class="title">Please</span> <span class="title">enter</span> <span class="title">the</span> <span class="title">gitlab</span>-<span class="title">ci</span> <span class="title">token</span> <span class="title">for</span> <span class="title">this</span> <span class="title">runner</span>:</span></span><br><span class="line"><span class="function"><span class="title">token</span></span></span><br><span class="line"><span class="function"><span class="title">Please</span> <span class="title">enter</span> <span class="title">the</span> <span class="title">gitlab</span>-<span class="title">ci</span> <span class="title">description</span> <span class="title">for</span> <span class="title">this</span> <span class="title">runner</span>:</span></span><br><span class="line"><span class="function">[<span class="title">DESKTOP</span>-2<span class="title">P9GHDD</span>]: <span class="title">xishuai</span>-<span class="title">ci</span></span></span><br><span class="line"><span class="function"><span class="title">Please</span> <span class="title">enter</span> <span class="title">the</span> <span class="title">gitlab</span>-<span class="title">ci</span> <span class="title">tags</span> <span class="title">for</span> <span class="title">this</span> <span class="title">runner</span> (<span class="title">comma</span> <span class="title">separated</span>):</span></span><br><span class="line"><span class="function"><span class="title">dev</span></span></span><br><span class="line"><span class="function"><span class="title">Registering</span> <span class="title">runner</span>... <span class="title">succeeded</span>                     <span class="title">runner</span>=<span class="title">avuSXASJ</span></span></span><br><span class="line"><span class="function"><span class="title">Please</span> <span class="title">enter</span> <span class="title">the</span> <span class="title">executor</span>: <span class="title">docker</span>-<span class="title">ssh</span>, <span class="title">parallels</span>, <span class="title">shell</span>, <span class="title">ssh</span>, <span class="title">virtualbox</span>, <span class="title">docker</span>+<span class="title">machine</span>, <span class="title">docker</span>-<span class="title">ssh</span>+<span class="title">machine</span>, <span class="title">docker</span>:</span></span><br><span class="line"><span class="function"><span class="title">shell</span></span></span><br><span class="line"><span class="function"><span class="title">Runner</span> <span class="title">registered</span> <span class="title">successfully</span>. <span class="title">Feel</span> <span class="title">free</span> <span class="title">to</span> <span class="title">start</span> <span class="title">it</span>, <span class="title">but</span> <span class="title">if</span> <span class="title">it</span>&#x27;<span class="title">s</span> <span class="title">running</span> <span class="title">already</span> <span class="title">the</span> <span class="title">config</span> <span class="title">should</span> <span class="title">be</span> <span class="title">automatically</span> <span class="title">reloaded</span>!</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢<code>executor: shell </code>æ˜¯é»˜è®¤é…ç½®ï¼Œæ„æ€æ˜¯æœ¬åœ°æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<code>ssh</code>å’Œ<code>docker</code>ï¼Œä¸è¿‡éœ€è¦å¢åŠ ä¸€äº›è¿œç«¯é“¾æ¥é…ç½®ã€‚</p>
<p>å®Œæˆåï¼Œä¼šåœ¨<code>C:\Multi-Runner</code>ç›®å½•ä¸‹ï¼Œç”Ÿæˆä¸€ä¸ª<code>config.toml</code>é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬ä¸Šé¢è¾“å…¥çš„é…ç½®ä¿¡æ¯ä¹Ÿéƒ½ä¼šåœ¨è¿™é‡Œé¢ï¼Œé…ç½®è¯´æ˜ï¼š<a target="_blank" rel="noopener" href="https://gitlab.com/gitlab-org/gitlab-ci-multi-runner/blob/master/docs/configuration/advanced-configuration.md">https://gitlab.com/gitlab-org/gitlab-ci-multi-runner/blob/master/docs/configuration/advanced-configuration.md</a></p>
<p>åœæ­¢ï¼Œè¿è¡Œå’ŒéªŒè¯å‘½ä»¤ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">C:\Multi-Runner&gt;gitlab-ci-multi-runner-windows-amd64.exe stop</span><br><span class="line"></span><br><span class="line">C:\Multi-Runner&gt;gitlab-ci-multi-runner-windows-amd64.exe start</span><br><span class="line"></span><br><span class="line">C:\Multi-Runner&gt;gitlab-ci-multi-runner-windows-amd64.exe verify</span><br><span class="line">Verifying runner... is alive                        runner=5ae63365</span><br></pre></td></tr></table></figure>

<p>å¦‚æœè¿è¡Œ<code>C:\Multi-Runner&gt;gitlab-ci-multi-runner-windows-amd64.exe start</code>å‡ºç°é”™è¯¯ï¼Œåˆ™éœ€è¦å°†<code>gitlab-ci-multi-runner-windows-amd64.exe</code>æ‹·è´ä¸€ä»½ï¼Œé‡å‘½åä¸º<code>gitlab-ci-multi-runner.exe</code>ã€‚</p>
<p>å¦å¤–ï¼Œ Gitlab é¡¹ç›® <strong>Settings &gt; Project Settings Features &gt; Builds</strong> é€‰é¡¹éœ€è¦æ‰“å‹¾ã€‚</p>
<p>gitlab-ci-multi-runner å®‰è£…é…ç½®å®Œä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ Gitlab é¡¹ç›® <strong>Settings &gt; Runners</strong> ä¸­ï¼Œçœ‹åˆ° Runners çš„ä¿¡æ¯äº†ã€‚</p>
<p><img src="https://images2015.cnblogs.com/blog/435188/201605/435188-20160505153302341-2007940860.png" alt="img"></p>
<h2 id="2-restore-nuget-packages"><a href="#2-restore-nuget-packages" class="headerlink" title="2. restore nuget packages"></a>2. restore nuget packages</h2><p>è¿™æ¬¡ä»»åŠ¡ï¼šä½¿ç”¨ CIï¼Œ nuget è¿˜åŸè§£å†³æ–¹æ¡ˆä¸­çš„ç¨‹åºåŒ…ã€‚</p>
<p>gitlab-ci-multi-runner å®‰è£…é…ç½®å®Œä¹‹åï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨ Gitlab é¡¹ç›®ä¸­æ·»åŠ ä¸€ä¸ª<code>.gitlab-ci.yml</code>æ–‡ä»¶ï¼Œå®˜æ–¹ä»‹ç»ï¼š<a target="_blank" rel="noopener" href="http://doc.gitlab.com/ee/ci/yaml/README.html">http://doc.gitlab.com/ee/ci/yaml/README.html</a></p>
<p>å› ä¸ºä¸€å¼€å§‹æˆ‘å¯¹<code>.gitlab-ci.yml</code>é…ç½®ä¸€ç‚¹éƒ½ä¸äº†è§£ï¼Œæ‰€ä»¥ï¼Œæˆ‘å½“æ—¶æŒ‰ç…§è¿™ä¸ªæ•™ç¨‹ <a target="_blank" rel="noopener" href="http://doc.gitlab.com/ce/ci/quick_start/README.html">CI Quick Start</a>ï¼Œæ·»åŠ äº†å¦‚ä¸‹çš„<code>.gitlab-ci.yml</code>æ–‡ä»¶é…ç½®ï¼š</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">before_script:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">apt-get</span> <span class="string">update</span> <span class="string">-qq</span> <span class="string">&amp;&amp;</span> <span class="string">apt-get</span> <span class="string">install</span> <span class="string">-y</span> <span class="string">-qq</span> <span class="string">sqlite3</span> <span class="string">libsqlite3-dev</span> <span class="string">nodejs</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ruby</span> <span class="string">-v</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">which</span> <span class="string">ruby</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">gem</span> <span class="string">install</span> <span class="string">bundler</span> <span class="string">--no-ri</span> <span class="string">--no-rdoc</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">bundle</span> <span class="string">install</span> <span class="string">--jobs</span> <span class="string">$(nproc)</span>  <span class="string">&quot;$&#123;FLAGS[@]&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">rspec:</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">bundle</span> <span class="string">exec</span> <span class="string">rspec</span></span><br><span class="line"></span><br><span class="line"><span class="attr">rubocop:</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">bundle</span> <span class="string">exec</span> <span class="string">rubocop</span></span><br></pre></td></tr></table></figure>

<p>æ·»åŠ å¥½<code>.gitlab-ci.yml</code>æ–‡ä»¶é…ç½®åï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨é¡¹ç›®ä¸­çš„ <strong>Builds</strong>ï¼Œçœ‹åˆ°æäº¤åçš„æ„å»ºå·¥ä½œäº†ï¼Œéšä¾¿åœ¨ Gitlab é¡¹ç›®ä¸­æ·»åŠ ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œç„¶åå†æ·»åŠ ä¸€ä¸ªç±»åº“é¡¹ç›®ï¼Œå¹¶ä¸”ä½¿ç”¨ nuget å®‰è£…ä¸€ä¸ªç¨‹åºåŒ…ï¼Œæœ€åä½¿ç”¨ git æäº¤åˆ° Gitlab ä¸­ï¼Œå°±å¯ä»¥çœ‹åˆ° <strong>Builds</strong> çš„è¿‡ç¨‹å’Œç»“æœäº†ï¼Œé¦–æ¬¡æäº¤ç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">gitlab-ci-multi-runner <span class="number">1</span>.<span class="number">1</span>.<span class="number">3</span> (a470667)</span><br><span class="line">Using Shell executor...</span><br><span class="line">Running on DESKTOP-<span class="number">2</span>P9GHDD...</span><br><span class="line">Cloning repository...</span><br><span class="line">&#x27;&quot;git&quot;&#x27; ï¿½ï¿½ï¿½ï¿½ï¿½Ú²ï¿½ï¿½ï¿½ï¿½â²¿ï¿½ï¿½ï¿½î£¬Ò²ï¿½ï¿½ï¿½Ç¿ï¿½ï¿½ï¿½ï¿½ĞµÄ³ï¿½ï¿½ï¿½</span><br><span class="line">ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ä¼ï¿½ï¿½ï¿½</span><br><span class="line">ÏµÍ³ï¿½Ò²ï¿½ï¿½ï¿½Ö¸ï¿½ï¿½ï¿½ï¿½Â·ï¿½ï¿½ï¿½ï¿½</span><br><span class="line">Checking out <span class="number">2</span>f82ccb0 as master...</span><br><span class="line">&#x27;&quot;git&quot;&#x27; ï¿½ï¿½ï¿½ï¿½ï¿½Ú²ï¿½ï¿½ï¿½ï¿½â²¿ï¿½ï¿½ï¿½î£¬Ò²ï¿½ï¿½ï¿½Ç¿ï¿½ï¿½ï¿½ï¿½ĞµÄ³ï¿½ï¿½ï¿½</span><br><span class="line">ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ä¼ï¿½ï¿½ï¿½</span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">ERROR: <span class="title">Build</span> <span class="title">failed</span>: <span class="title">exit</span> <span class="title">status</span> 9009</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªé—®é¢˜æäº†æˆ‘å¾ˆä¹…ï¼Œå› ä¸ºé”™è¯¯ä¿¡æ¯ä¹±ç äº†ï¼Œæ ¹æœ¬æ‰¾ä¸åˆ°ç›¸å…³çš„è§£å†³æ–¹æ¡ˆï¼Œåæ¥æ— æ„é—´æœåˆ° Gitlab ä¸­çš„ä¸€ä¸ª Issueï¼Œé‡Œé¢æåˆ°äº†ä¸€ä¸ª<code>gitlab-ci-multi-runner --debug run</code>å‘½ä»¤ï¼Œæ„æ€æ˜¯è°ƒè¯•è¿è¡Œ CIï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯äº†ï¼Œdebug çš„é”™è¯¯ä¿¡æ¯æ¯”è¾ƒå¤šï¼Œå¹¶ä¸”å®Œå…¨çœ‹ä¸æ‡‚ï¼Œä¸è¿‡æˆ‘ä»¬å¯ä»¥é€šè¿‡ <strong>Builds</strong> çœ‹åˆ°ç®€æ´çš„é”™è¯¯æ—¥å¿—ï¼š</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">gitlab-ci-multi-runner <span class="number">1</span>.<span class="number">1</span>.<span class="number">3</span> (a470667)</span><br><span class="line">Using Shell executor...</span><br><span class="line">Running on DESKTOP-<span class="number">2</span>P9GHDD...</span><br><span class="line">Cloning repository...</span><br><span class="line">Cloning into &#x27;C:/Multi-Runner/builds/<span class="number">500</span>c7a25/<span class="number">0</span>/dev/CNBlogsCI-Sample&#x27;...</span><br><span class="line"><span class="function">fatal: <span class="title">unable</span> <span class="title">to</span> <span class="title">access</span> &#x27;<span class="title">https</span>://<span class="title">gitlab</span>-<span class="title">ci</span>-<span class="title">token:xxxxxx</span>@<span class="title">gitlab.com</span>/<span class="title">dev</span>/<span class="title">CNBlogsCI</span>-<span class="title">Sample.git</span>/&#x27;: <span class="title">error</span> <span class="title">setting</span> <span class="title">certificate</span> <span class="title">verify</span> <span class="title">locations</span>:</span></span><br><span class="line"><span class="function">  <span class="title">CAfile</span>: <span class="title">C</span>:\<span class="title">Multi</span>-<span class="title">Runner</span>\<span class="title">builds</span>\500<span class="title">c7a25</span>\0\<span class="title">dev</span>\<span class="title">CNBlogsCI</span>-<span class="title">Sample.tmp</span>\<span class="title">GIT_SSL_CAINFO</span></span></span><br><span class="line"><span class="function">  <span class="title">CApath</span>: <span class="title">none</span></span></span><br><span class="line"><span class="function"><span class="title">The</span> <span class="title">system</span> <span class="title">cannot</span> <span class="title">find</span> <span class="title">the</span> <span class="title">path</span> <span class="title">specified</span>.</span></span><br><span class="line"><span class="function"><span class="title">Checking</span> <span class="title">out</span> <span class="title">ac05d090</span> <span class="title">as</span> <span class="title">master</span>...</span></span><br><span class="line"><span class="function"><span class="title">fatal</span>: <span class="title">Not</span> <span class="title">a</span> <span class="title">git</span> <span class="title">repository</span> (<span class="title">or</span> <span class="title">any</span> <span class="title">of</span> <span class="title">the</span> <span class="title">parent</span> <span class="title">directories</span>): .<span class="title">git</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">ERROR</span>: <span class="title">Build</span> <span class="title">failed</span>: <span class="title">exit</span> <span class="title">status</span> 128</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢é”™è¯¯æ—¥å¿—çš„æ„æ€æ˜¯ï¼Œæ²¡æœ‰<code>git clone repository </code>æˆåŠŸï¼Œå¹¶ä¸”æ²¡æœ‰æƒé™è®¿é—®ï¼Œåæ¥ Google åˆ°äº†ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼š<a target="_blank" rel="noopener" href="https://gitlab.com/gitlab-org/gitlab-ci-multi-runner/issues/1052">error setting certificate verify locations</a></p>
<p>è§£å†³æ–¹å¼ï¼š<code>C:\Multi-Runner\config.toml</code>æ–‡ä»¶æ·»åŠ <code>shell = &#39;powershell&#39;</code>èŠ‚ç‚¹ï¼Œæ·»åŠ åœ¨<code>[[runners]]</code>èŠ‚ç‚¹åã€‚</p>
<p>è§£å†³å®Œè¿™ä¸ªé—®é¢˜ä¹‹åï¼Œå»ç ”ç©¶äº†ä¸‹<code>.gitlab-ci.yml</code>ä¸­çš„<code>nuget restore</code>é…ç½®ï¼ˆGoogle æœçš„ï¼Œå¤ªå‘ï¼‰ï¼Œå°†<code>.gitlab-ci.yml</code>æ–‡ä»¶ä¿®æ”¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">stages:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">build</span></span><br><span class="line"></span><br><span class="line"><span class="attr">job:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">build</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ls</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">echo</span> <span class="string">&quot;Restoring NuGet Packages...&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;&quot;C:\Users\xishuai\.dnx\packages\ClassLibrary2\2.0.0\packages\NuGet.CommandLine.2.8.5\tools\NuGet.exe&quot; restore &quot;src/CNBlogsCI-Sample.sln&quot;&#x27;</span></span><br></pre></td></tr></table></figure>

<p><code>commit</code>æäº¤æµ‹è¯•ï¼Œå‡ºç°ä¸‹é¢çš„é”™è¯¯ä¿¡æ¯ï¼š</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">gitlab-ci-multi-runner <span class="number">1</span>.<span class="number">1</span>.<span class="number">3</span> (a470667)</span><br><span class="line">Using Shell executor...</span><br><span class="line"><span class="built_in">At</span> C:\Users\xishuai\AppData\Local\Temp\build_script140243225\script.ps1:<span class="number">132</span> char:<span class="number">105</span></span><br><span class="line">+ ... <span class="number">0</span>.<span class="number">0</span>\packages\NuGet.CommandLine.<span class="number">2</span>.<span class="number">8</span>.<span class="number">5</span>\tools\NuGet.exe&quot; <span class="built_in">restore</span> &quot;src/CN ...</span><br><span class="line">+                                                           ~~~~~~~</span><br><span class="line">Unexpected token &#x27;<span class="built_in">restore</span>&#x27; <span class="keyword">in</span> expression or statement.</span><br><span class="line">    + CategoryInfo          : ParserError: (:) [], ParseException</span><br><span class="line">    + FullyQualifiedErrorId : UnexpectedToken</span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">ERROR: <span class="title">Build</span> <span class="title">failed</span>: <span class="title">exit</span> <span class="title">status</span> 1</span></span><br></pre></td></tr></table></figure>

<p>ä»é”™è¯¯ä¿¡æ¯ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ²¡æœ‰è¯†åˆ«<code>restore</code>å‘½ä»¤ï¼Œå•¥æ„æ€ï¼Ÿè¿™ä¸ªé—®é¢˜åˆæäº†æˆ‘å¥½ä¹…ï¼ŒGoogle <code>Unexpected token &#39;restore&#39; in expression or statement.</code> å…³é”®å­—ï¼Œæ¯›éƒ½æœä¸åˆ°ï¼Œæ²¡åŠæ³•ï¼Œåæ¥åªèƒ½æ›´æ¢å…³é”®å­—æœï¼Œä½†æœåˆ°çš„ä¿¡æ¯å‡¤æ¯›éºŸè§’ï¼Œåæ¥å‚è€ƒæœæ¥çš„èµ„æ–™ï¼Œå°†<code>.gitlab-ci.yml</code>æ”¹ä¸ºï¼š</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">stages:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">build</span></span><br><span class="line"></span><br><span class="line"><span class="attr">job:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">build</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ls</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">echo</span> <span class="string">&quot;Restoring NuGet Packages...&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;call &quot;%VS140COMNTOOLS%\vsvars32.bat&quot;&#x27;</span></span><br><span class="line"><span class="comment">#  - &#x27;&quot;C:\Users\xishuai\.dnx\packages\ClassLibrary2\2.0.0\packages\NuGet.CommandLine.2.8.5\tools\NuGet.exe&quot; restore &quot;src\CNBlogsCI-Sample.sln&quot;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>æˆ–</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">before_script:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">echo</span> <span class="string">&quot;Restoring NuGet Packages...&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&#x27;call &quot;C:\Program Files (x86)\Microsoft Visual Studio 14.0\Common7\Tools\vsvars32.bat&quot;&#x27;</span></span><br></pre></td></tr></table></figure>

<p><code>%VS140COMNTOOLS%\vsvars32.bat</code> æ˜¯ä»€ä¹ˆé¬¼ï¼Ÿä¸å¤ªæ¸…æ¥šï¼Œæ¯«æ— ç–‘é—®ï¼Œåˆå‡ºç°äº†é”™è¯¯ï¼Œä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">gitlab-ci-multi-runner <span class="number">1</span>.<span class="number">1</span>.<span class="number">3</span> (a470667)</span><br><span class="line">Using Shell executor...</span><br><span class="line">Running on DESKTOP-<span class="number">2</span>P9GHDD...</span><br><span class="line">Fetching changes...</span><br><span class="line">HEAD is now <span class="built_in">at</span> <span class="number">3926803</span> Update .gitlab-ci.yml</span><br><span class="line">From https://gitlab.com/dev/CNBlogsCI-Sample</span><br><span class="line">   <span class="number">3926803</span>..d8f10a7  master     -&gt; origin/master</span><br><span class="line">Checking out d8f10a7c as master...</span><br><span class="line">Previous HEAD position was <span class="number">3926803</span>... Update .gitlab-ci.yml</span><br><span class="line">HEAD is now <span class="built_in">at</span> d8f10a7... Update .gitlab-ci.yml</span><br><span class="line">$ ls</span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    Directory: <span class="title">C</span>:\<span class="title">Multi</span>-<span class="title">Runner</span>\<span class="title">builds</span>\5<span class="title">ae63365</span>\0\<span class="title">dev</span>\<span class="title">CNBlogsCI</span>-<span class="title">Sample</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">Mode</span>                <span class="title">LastWriteTime</span>         <span class="title">Length</span> <span class="title">Name</span>                                                                  </span></span><br><span class="line"><span class="function">----                -------------         ------ ----                                                                  </span></span><br><span class="line"><span class="function"><span class="title">d</span>-----         5/4/2016  02:45 <span class="title">PM</span>                <span class="title">src</span>                                                                   </span></span><br><span class="line"><span class="function">-<span class="title">a</span>----         5/4/2016  02:45 <span class="title">PM</span>             89 .<span class="title">gitignore</span>                                                            </span></span><br><span class="line"><span class="function">-<span class="title">a</span>----         5/4/2016  02:49 <span class="title">PM</span>            527 .<span class="title">gitlab</span>-<span class="title">ci.yml</span>                                                        </span></span><br><span class="line"><span class="function">$ <span class="title">echo</span> &quot;<span class="title">Restoring</span> <span class="title">NuGet</span> <span class="title">Packages</span>...&quot;</span></span><br><span class="line"><span class="function"><span class="title">Restoring</span> <span class="title">NuGet</span> <span class="title">Packages</span>...</span></span><br><span class="line"><span class="function">$ <span class="title">call</span> &quot;%<span class="title">VS140COMNTOOLS</span>%\<span class="title">vsvars32.bat</span>&quot;</span></span><br><span class="line"><span class="function"><span class="title">call</span> : <span class="title">The</span> <span class="title">term</span> &#x27;<span class="title">call</span>&#x27; <span class="title">is</span> <span class="title">not</span> <span class="title">recognized</span> <span class="title">as</span> <span class="title">the</span> <span class="title">name</span> <span class="title">of</span> <span class="title">a</span> <span class="title">cmdlet</span>, <span class="title">function</span>, <span class="title">script</span> <span class="title">file</span>, <span class="title">or</span> <span class="title">operable</span> <span class="title">program</span>. <span class="title">Check</span> </span></span><br><span class="line"><span class="function"><span class="title">the</span> <span class="title">spelling</span> <span class="title">of</span> <span class="title">the</span> <span class="title">name</span>, <span class="title">or</span> <span class="title">if</span> <span class="title">a</span> <span class="title">path</span> <span class="title">was</span> <span class="title">included</span>, <span class="title">verify</span> <span class="title">that</span> <span class="title">the</span> <span class="title">path</span> <span class="title">is</span> <span class="title">correct</span> <span class="title">and</span> <span class="title">try</span> <span class="title">again</span>.</span></span><br><span class="line"><span class="function"><span class="title">At</span> <span class="title">C</span>:\<span class="title">Users</span>\<span class="title">xishuai</span>\<span class="title">AppData</span>\<span class="title">Local</span>\<span class="title">Temp</span>\<span class="title">build_script250102679</span>\<span class="title">script.ps1</span>:132 <span class="title">char</span>:3</span></span><br><span class="line"><span class="function">+   <span class="title">call</span> &quot;%<span class="title">VS140COMNTOOLS</span>%\<span class="title">vsvars32.bat</span>&quot;</span></span><br><span class="line"><span class="function">+   ~~~~</span></span><br><span class="line"><span class="function">    + <span class="title">CategoryInfo</span>          : <span class="title">ObjectNotFound</span>: (<span class="title">call:String</span>) [], <span class="title">ParentContainsErrorRecordException</span></span></span><br><span class="line"><span class="function">    + <span class="title">FullyQualifiedErrorId</span> : <span class="title">CommandNotFoundException</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">ERROR</span>: <span class="title">Build</span> <span class="title">failed</span>: <span class="title">exit</span> <span class="title">status</span> 1</span></span><br></pre></td></tr></table></figure>

<p>ä¹Ÿæ˜¯æ¯«æ— å¤´ç»ªçš„é”™è¯¯ï¼Œè¿™ä¹ˆåŠå‘¢ï¼Ÿåæ¥æƒ³æƒ³<code>nuget restore</code>å§‹ç»ˆä¸æˆåŠŸï¼Œèƒ½ä¸èƒ½æ¢ä¸ªå‘½ä»¤å‘¢ï¼Ÿçªç„¶æƒ³åˆ°äº† ASP.NET 5ï¼Œè¿˜åŸç¨‹åºåŒ…ä½¿ç”¨çš„æ˜¯<code>dnu restore</code>å‘½ä»¤ï¼Œé‚£å°±å°è¯•ä¸‹å§ï¼Œå°†è§£å†³æ–¹æ¡ˆä¸­çš„é¡¹ç›®åˆ æ‰ï¼Œç„¶åæ·»åŠ  ASP.NET 5 é¡¹ç›®ï¼Œ<code>.gitlab-ci.yml</code>æ”¹ä¸ºï¼š</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">before_script:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">echo</span> <span class="string">&quot;Restoring NuGet Packages...&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">dnvm</span> <span class="string">use</span> <span class="number">1.0</span><span class="number">.0</span><span class="string">-beta5</span> <span class="string">-r</span> <span class="string">coreclr</span> <span class="string">-a</span> <span class="string">x64</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">dnu</span> <span class="string">restore</span></span><br></pre></td></tr></table></figure>

<p>å“‡å¡ï¼Œè¿™æ¬¡ç»ˆäºæˆåŠŸäº†ï¼ˆçªç„¶æœ‰ç§æƒ³å“­çš„å†²åŠ¨ğŸ˜­ï¼‰ï¼Œæ—¥å¿—ä¿¡æ¯ï¼š</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">Running on DESKTOP-<span class="number">2</span>P9GHDD...</span><br><span class="line">Fetching changes...</span><br><span class="line">HEAD is now <span class="built_in">at</span> <span class="number">33436</span>d8 test commit</span><br><span class="line">From https://gitlab.com/dev/CNBlogsCI-Sample</span><br><span class="line">   <span class="number">33436</span>d8..c80b2d5  master     -&gt; origin/master</span><br><span class="line">Checking out c80b2d5d as master...</span><br><span class="line">Previous HEAD position was <span class="number">33436</span>d8... test commit</span><br><span class="line">HEAD is now <span class="built_in">at</span> c80b2d5... test commit</span><br><span class="line">$ <span class="built_in">echo</span> &quot;Release build...&quot;</span><br><span class="line">Release build...</span><br><span class="line">$ dnvm use <span class="number">1</span>.<span class="number">0</span>.<span class="number">0</span>-beta5 -r coreclr -a x64</span><br><span class="line">Adding C:\Users\xishuai\.dnx\runtimes\dnx-coreclr-win-x64.<span class="number">1</span>.<span class="number">0</span>.<span class="number">0</span>-beta5\bin to process <span class="built_in">PATH</span></span><br><span class="line">$ dnu <span class="built_in">restore</span></span><br><span class="line">Microsoft .<span class="built_in">NET</span> Development Utility CoreCLR-x64-<span class="number">1</span>.<span class="number">0</span>.<span class="number">0</span>-beta5-<span class="number">12103</span></span><br><span class="line"></span><br><span class="line">Restoring packages <span class="keyword">for</span> C:\Multi-Runner\builds\<span class="number">5</span>ae63365\<span class="number">0</span>\dev\CNBlogsCI-Sample\src\CNBlogsCI-Sample.ClassLibrary\project.json</span><br><span class="line">  GET https://www.nuget.org/api/v2/</span><br><span class="line">  OK https://www.nuget.org/api/v2/ <span class="number">5524</span>ms</span><br><span class="line">  GET http://nuget.cnitblog.com/nuget/Default/</span><br><span class="line">  OK http://nuget.cnitblog.com/nuget/Default/ <span class="number">2406</span>ms</span><br><span class="line">  GET https://www.myget.org/F/aspnetvnext/api/v2/</span><br><span class="line">  OK https://www.myget.org/F/aspnetvnext/api/v2/ <span class="number">5225</span>ms</span><br><span class="line">  CACHE https://www.nuget.org/api/v2/</span><br><span class="line">  GET https://www.myget.org/F/aspnetmaster/api/v3/index.json</span><br><span class="line">  OK https://www.myget.org/F/aspnetmaster/api/v3/index.json <span class="number">2938</span>ms</span><br><span class="line">  GET https://www.myget.org/F/xunit/api/v3/index.json</span><br><span class="line">  OK https://www.myget.org/F/xunit/api/v3/index.json <span class="number">1976</span>ms</span><br><span class="line">Writing lock file C:\Multi-Runner\builds\<span class="number">5</span>ae63365\<span class="number">0</span>\dev\CNBlogsCI-Sample\src\CNBlogsCI-Sample.ClassLibrary\project.lock.json</span><br><span class="line"><span class="built_in">Restore</span> complete, <span class="number">18775</span>ms elapsed</span><br><span class="line"></span><br><span class="line">Build succeeded</span><br></pre></td></tr></table></figure>

<p>è™½ç„¶ ASP.NET 5 è¿˜åŸç¨‹åºåŒ…æˆåŠŸäº†ï¼Œä½†ä¾æ—§è§£å†³ä¸äº†é—®é¢˜å•Šï¼Œå› ä¸ºå¿…é¡»å¾—è§£å†³<code>nuget restore</code>çš„é—®é¢˜ï¼Œå› ä¸ºå¾ˆå¤šé¡¹ç›®éƒ½æ²¡ç”¨ ASP.NET 5ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿåˆå›åˆ°äº†å‡ºå‘ç‚¹ï¼Œé—®é¢˜èƒ½ç£¨æ­»äººå•Šï¼Œè¿‡ç¨‹å°±ä¸å™è¿°äº†ï¼Œåæ¥æ— æ„é—´å°†<code>.gitlab-ci.yml</code>æ”¹ä¸ºï¼š</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">before_script:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">echo</span> <span class="string">&quot;Restoring NuGet Packages...&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">C:\Program</span> <span class="string">Files</span> <span class="string">(x86)\NuGet\nuget.exe</span> <span class="string">restore</span> <span class="string">src/CNBlogsCI-Sample.sln</span></span><br></pre></td></tr></table></figure>

<p>ä»”ç»†çœ‹çœ‹å’Œä¸Šé¢çš„é…ç½®æœ‰ä»€ä¹ˆä¸åŒï¼Œæˆ‘æŠŠ<code>&#39;&quot;</code>å»æ‰äº†ï¼Œ<code>commit</code>ä»£ç æµ‹è¯•ï¼Œå‡ºç°äº†ä¸‹é¢å’Œä¸€å¼€å§‹ä¸ä¸€æ ·çš„é”™è¯¯ï¼ˆæœ‰æˆäº†ğŸ˜ï¼‰ï¼š</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">gitlab-ci-multi-runner <span class="number">1</span>.<span class="number">1</span>.<span class="number">3</span> (a470667)</span><br><span class="line">Using Shell executor...</span><br><span class="line">Running on DESKTOP-<span class="number">2</span>P9GHDD...</span><br><span class="line">Fetching changes...</span><br><span class="line">Removing src/ClassLibrary1/bin/</span><br><span class="line">Removing src/ClassLibrary1/obj/</span><br><span class="line">HEAD is now <span class="built_in">at</span> <span class="number">191</span>e7e0 test commit</span><br><span class="line">From https://gitlab.com/dev/CNBlogsCI-Sample</span><br><span class="line">   <span class="number">191</span>e7e0..feebdef  master     -&gt; origin/master</span><br><span class="line">Checking out feebdefb as master...</span><br><span class="line">Previous HEAD position was <span class="number">191</span>e7e0... test commit</span><br><span class="line">HEAD is now <span class="built_in">at</span> feebdef... test commit</span><br><span class="line">$ <span class="built_in">echo</span> &quot;Restoring NuGet Packages...&quot;</span><br><span class="line">Restoring NuGet Packages...</span><br><span class="line">$ C:\Program Files (x86)\NuGet\nuget.exe <span class="built_in">restore</span> src/CNBlogsCI-Sample.sln</span><br><span class="line">x86 : The term &#x27;x86&#x27; is <span class="keyword">not</span> recognized as the name of a cmdlet, function, script file, or operable program. Check the </span><br><span class="line">spelling of the name, or <span class="keyword">if</span> a <span class="built_in">path</span> was included, <span class="built_in">verify</span> that the <span class="built_in">path</span> is correct and try again.</span><br><span class="line"><span class="built_in">At</span> C:\Users\xishuai\AppData\Local\Temp\build_script166211738\script.ps1:<span class="number">128</span> char:<span class="number">21</span></span><br><span class="line">+   C:\Program Files (x86)\NuGet\nuget.exe <span class="built_in">restore</span> src/CNBlogsCI-Sample ...</span><br><span class="line">+                     ~~~</span><br><span class="line">    + CategoryInfo          : ObjectNotFound: (x86:String) [], ParentContainsErrorRecordException</span><br><span class="line">    + FullyQualifiedErrorId : CommandNotFoundException</span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">ERROR: <span class="title">Build</span> <span class="title">failed</span>: <span class="title">exit</span> <span class="title">status</span> 1</span></span><br></pre></td></tr></table></figure>

<p>æ ¹æ®ä¸Šé¢çš„é”™è¯¯æ—¥å¿—ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå°±æ˜¯ç›®å½•ä¸­çš„<code>x86</code>é—®é¢˜ï¼Œç„¶åæˆ‘æŠŠç›®å½•æ”¹ä¸º<code>C:\Program Files\NuGet\nuget.exe</code>ä¹‹åï¼ˆ<code>nuget.exe</code>æ‹·è´åˆ°ç›¸åº”ç›®å½•ä¸‹ï¼‰ï¼Œè¿˜æ˜¯æœ‰é—®é¢˜ï¼Œç„¶åå°±ç›´æ¥æ”¾åœ¨<code>C</code>ç›˜ç›®å½•ä¸‹ï¼Œç»ˆäº<code>build</code>æˆåŠŸï¼ˆçœ¼æ³ªå¤ºçœ¶è€Œå‡ºğŸ˜‚ï¼‰ã€‚</p>
<p><code>.gitlab-ci.yml</code>é…ç½®ï¼š</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">before_script:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">echo</span> <span class="string">&quot;Restoring NuGet Packages...&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">C:\NuGet\nuget.exe</span> <span class="string">restore</span> <span class="string">&quot;src\CNBlogsCI-Sample.sln&quot;</span></span><br></pre></td></tr></table></figure>

<p><code>build</code>æˆåŠŸæ—¥å¿—ï¼š</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">gitlab-ci-multi-runner <span class="number">1</span>.<span class="number">1</span>.<span class="number">3</span> (a470667)</span><br><span class="line">Using Shell executor...</span><br><span class="line">Running on DESKTOP-<span class="number">2</span>P9GHDD...</span><br><span class="line">Fetching changes...</span><br><span class="line">HEAD is now <span class="built_in">at</span> <span class="number">1</span>ac80d7 test commit</span><br><span class="line">From https://gitlab.com/dev/CNBlogsCI-Sample</span><br><span class="line">   <span class="number">1</span>ac80d7..<span class="number">683</span>a8bc  master     -&gt; origin/master</span><br><span class="line">Checking out <span class="number">683</span>a8bcb as master...</span><br><span class="line">Previous HEAD position was <span class="number">1</span>ac80d7... test commit</span><br><span class="line">HEAD is now <span class="built_in">at</span> <span class="number">683</span>a8bc... test commit</span><br><span class="line">$ <span class="built_in">echo</span> &quot;Restoring NuGet Packages...&quot;</span><br><span class="line">Restoring NuGet Packages...</span><br><span class="line">$ C:\NuGet\nuget.exe <span class="built_in">restore</span> &quot;src\CNBlogsCI-Sample.sln&quot;</span><br><span class="line">Installing &#x27;AutoMapper <span class="number">4</span>.<span class="number">2</span>.<span class="number">1</span>&#x27;.</span><br><span class="line">Successfully installed &#x27;AutoMapper <span class="number">4</span>.<span class="number">2</span>.<span class="number">1</span>&#x27;.</span><br><span class="line"></span><br><span class="line">Build succeeded</span><br></pre></td></tr></table></figure>

<p>çœ‹ä¼¼ç®€å•çš„ç»“æœï¼Œä½†è¿‡ç¨‹çœŸæ˜¯å¤ªæ‰¯è›‹äº†ï¼Œå¦‚æœæˆ‘å½“æ—¶çœ‹åˆ°ç±»ä¼¼è¿™ç¯‡åšæ–‡åˆ†äº«ï¼Œä¹Ÿä¸è‡³äºå¦‚æ­¤ï¼Œè¿˜æ²¡å®Œï¼Œç»§ç»­ã€‚ã€‚ã€‚</p>
<h2 id="3-build-sln"><a href="#3-build-sln" class="headerlink" title="3. build *.sln"></a>3. build *.sln</h2><p>è¿™æ¬¡ä»»åŠ¡ï¼šä½¿ç”¨ CIï¼Œ build ç”Ÿæˆè§£å†³æ–¹æ¡ˆä¸­çš„é¡¹ç›®ã€‚</p>
<p>ç”Ÿæˆè§£å†³æ–¹æ¡ˆçš„é—®é¢˜è§£å†³è¿‡ç¨‹ç›¸å¯¹ç®€å•äº›ï¼Œä¸è¿‡ä¸Šé¢æ¼æ‰äº†ä¸€å¤„ï¼Œè¿™è¾¹å†è¡¥å……ä¸‹ï¼Œ<code>.gitlab-ci.yml</code>é…ç½®ï¼š</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">stages:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">build</span></span><br><span class="line"></span><br><span class="line"><span class="attr">job:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">build</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">echo</span> <span class="string">&quot;Release build...&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">C:\Windows\Microsoft.NET\Framework64\v4.0.30319\msbuild.exe</span> <span class="string">/consoleloggerparameters:ErrorsOnly</span> <span class="string">/maxcpucount</span> <span class="string">/nologo</span> <span class="string">/property:Configuration=Release</span> <span class="string">/verbosity:quiet</span> <span class="string">&quot;CNBlogsCI-Sample.sln&quot;</span></span><br><span class="line">  <span class="attr">tags:</span> </span><br><span class="line">  <span class="attr">except:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">tags</span></span><br></pre></td></tr></table></figure>

<p>é”™è¯¯æ—¥å¿—ï¼š</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">gitlab-ci-multi-runner <span class="number">1</span>.<span class="number">1</span>.<span class="number">3</span> (a470667)</span><br><span class="line">Using Shell executor...</span><br><span class="line">Running on DESKTOP-<span class="number">2</span>P9GHDD...</span><br><span class="line">Fetching changes...</span><br><span class="line">HEAD is now <span class="built_in">at</span> <span class="number">07</span>a6ffd Merge branch &#x27;master&#x27; of gitlab.com:dev/CNBlogsCI-Sample</span><br><span class="line">From https://gitlab.com/dev/CNBlogsCI-Sample</span><br><span class="line">   <span class="number">07</span>a6ffd..<span class="number">73</span>bd820  master     -&gt; origin/master</span><br><span class="line">Checking out <span class="number">73</span>bd8207 as master...</span><br><span class="line">Previous HEAD position was <span class="number">07</span>a6ffd... Merge branch &#x27;master&#x27; of gitlab.com:dev/CNBlogsCI-Sample</span><br><span class="line">HEAD is now <span class="built_in">at</span> <span class="number">73</span>bd820... test commit</span><br><span class="line">$ <span class="built_in">echo</span> &quot;Release build...&quot;</span><br><span class="line">Release build...</span><br><span class="line">$ C:\Windows\Microsoft.<span class="built_in">NET</span>\Framework64\v4.<span class="number">0</span>.<span class="number">30319</span>\msbuild.exe /consoleloggerparameters:ErrorsOnly /maxcpucount /nologo /property:Configuration=Release /verbosity:quiet &quot;CNBlogsCI-Sample.sln&quot;</span><br><span class="line">MSBUILD : error MSB1009: ï¿½ï¿½Ä¿ï¿½Ä¼ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ú¡ï¿½</span><br><span class="line">ï¿½ï¿½ï¿½ï¿½: CNBlogsCI-Sample.sln</span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">ERROR: <span class="title">Build</span> <span class="title">failed</span>: <span class="title">exit</span> <span class="title">status</span> 1</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªé”™è¯¯å’Œæœ€å¼€å§‹çš„ä¹±ç é”™è¯¯ä¸€æ ·ï¼ŒæœªçŸ¥çš„é”™è¯¯ï¼Œæ— ä»ä¸‹æ‰‹ï¼Œåæ¥ï¼Œåˆæ— æ„é—´æœåˆ°äº†ä¸€ä¸ª Gitlab Issueï¼ˆå¥½å¤šæ— æ„é—´ğŸ˜„ï¼Œæ²¡åŠæ³•ï¼ŒGoogle åªèƒ½æœç´¢æ‰€æœ‰å¯èƒ½çš„å…³é”®å­—ï¼‰ï¼š<a target="_blank" rel="noopener" href="https://gitlab.com/gitlab-org/gitlab-ci-multi-runner/issues/1158">Question about local project path</a></p>
<p><code>.gitlab-ci.yml</code>é…ç½®æ”¹ä¸ºï¼š</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">stages:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">build</span></span><br><span class="line"></span><br><span class="line"><span class="attr">job:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">build</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ls</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">echo</span> <span class="string">&quot;Release build...&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">C:\Windows\Microsoft.NET\Framework64\v4.0.30319\msbuild.exe</span> <span class="string">/consoleloggerparameters:ErrorsOnly</span> <span class="string">/maxcpucount</span> <span class="string">/nologo</span> <span class="string">/property:Configuration=Release</span> <span class="string">/verbosity:quiet</span> <span class="string">&quot;CNBlogsCI-Sample.sln&quot;</span></span><br><span class="line">  <span class="attr">tags:</span> </span><br><span class="line">  <span class="attr">except:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">tags</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åçœ‹åˆ°äº†è¯¦ç»†é”™è¯¯ï¼ˆåˆæœ‰æˆäº†ğŸ˜ï¼‰ï¼š</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">gitlab-ci-multi-runner <span class="number">1</span>.<span class="number">1</span>.<span class="number">3</span> (a470667)</span><br><span class="line">Using Shell executor...</span><br><span class="line">Running on DESKTOP-<span class="number">2</span>P9GHDD...</span><br><span class="line">Fetching changes...</span><br><span class="line">HEAD is now <span class="built_in">at</span> eb2ec26 Update .gitlab-ci.yml</span><br><span class="line">Checking out eb2ec265 as master...</span><br><span class="line">HEAD is now <span class="built_in">at</span> eb2ec26... Update .gitlab-ci.yml</span><br><span class="line">$ ls</span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    Directory: <span class="title">C</span>:\<span class="title">Multi</span>-<span class="title">Runner</span>\<span class="title">builds</span>\5<span class="title">ae63365</span>\0\<span class="title">dev</span>\<span class="title">CNBlogsCI</span>-<span class="title">Sample</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">Mode</span>                <span class="title">LastWriteTime</span>         <span class="title">Length</span> <span class="title">Name</span>                                                                  </span></span><br><span class="line"><span class="function">----                -------------         ------ ----                                                                  </span></span><br><span class="line"><span class="function"><span class="title">d</span>-----         5/4/2016  10:26 <span class="title">AM</span>                <span class="title">src</span>                                                                   </span></span><br><span class="line"><span class="function">-<span class="title">a</span>----         5/4/2016  11:19 <span class="title">AM</span>            315 .<span class="title">gitlab</span>-<span class="title">ci.yml</span>                                                        </span></span><br><span class="line"><span class="function">$ <span class="title">echo</span> &quot;<span class="title">Release</span> <span class="title">build</span>...&quot;</span></span><br><span class="line"><span class="function"><span class="title">Release</span> <span class="title">build</span>...</span></span><br><span class="line"><span class="function">$ <span class="title">C</span>:\<span class="title">Windows</span>\<span class="title">Microsoft.NET</span>\<span class="title">Framework64</span>\<span class="title">v4</span>.0.30319\<span class="title">msbuild.exe</span> /<span class="title">consoleloggerparameters:ErrorsOnly</span> /<span class="title">maxcpucount</span> /<span class="title">nologo</span> /<span class="title">property:Configuration</span>=<span class="title">Release</span> /<span class="title">verbosity:quiet</span> &quot;<span class="title">CNBlogsCI</span>-<span class="title">Sample.sln</span>&quot;</span></span><br><span class="line"><span class="function"><span class="title">MSBUILD</span> : <span class="title">error</span> <span class="title">MSB1009</span>: <span class="title">Project</span> <span class="title">file</span> <span class="title">does</span> <span class="title">not</span> <span class="title">exist</span>.</span></span><br><span class="line"><span class="function"><span class="title">Switch</span>: <span class="title">CNBlogsCI</span>-<span class="title">Sample.sln</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">ERROR</span>: <span class="title">Build</span> <span class="title">failed</span>: <span class="title">exit</span> <span class="title">status</span> 1</span></span><br></pre></td></tr></table></figure>

<p><code>error MSB1009: Project file does not exist.</code>è¿™ä¸ªé”™è¯¯å°±å¾ˆæ¸…æ™°äº†ï¼Œé¡¹ç›®æ–‡ä»¶æ‰¾ä¸åˆ°ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰æ‰¾åˆ°<code>CNBlogsCI-Sample.sln</code>ï¼Œæ€ä¹ˆä¼šå‘¢ï¼Ÿé‡æ–°æŸ¥çœ‹äº† Gitlab ä¸­çš„é¡¹ç›®æ–‡ä»¶ç›®å½•ï¼Œ<code>CNBlogsCI-Sample.sln</code>åœ¨æ ¹ç›®å½•ä¸‹çš„<code>src</code>ç›®å½•ä¸‹ï¼Œé‡æ–°ä¿®æ”¹ä¸‹<code>.gitlab-ci.yml</code>é…ç½®ï¼š</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">stages:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">build</span></span><br><span class="line"></span><br><span class="line"><span class="attr">job:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">build</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ls</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">echo</span> <span class="string">&quot;Release build...&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">C:\Windows\Microsoft.NET\Framework64\v4.0.30319\msbuild.exe</span> <span class="string">/consoleloggerparameters:ErrorsOnly</span> <span class="string">/maxcpucount</span> <span class="string">/nologo</span> <span class="string">/property:Configuration=Release</span> <span class="string">/verbosity:quiet</span> <span class="string">&quot;src/CNBlogsCI-Sample.sln&quot;</span></span><br><span class="line">  <span class="attr">tags:</span> </span><br><span class="line">  <span class="attr">except:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">tags</span></span><br></pre></td></tr></table></figure>

<p><code>build</code>æˆåŠŸï¼Œæ—¥å¿—è¯¦æƒ…ï¼š</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">gitlab-ci-multi-runner <span class="number">1</span>.<span class="number">1</span>.<span class="number">3</span> (a470667)</span><br><span class="line">Using Shell executor...</span><br><span class="line">Running on DESKTOP-<span class="number">2</span>P9GHDD...</span><br><span class="line">Fetching changes...</span><br><span class="line">HEAD is now <span class="built_in">at</span> a51aeea test commit</span><br><span class="line">From https://gitlab.com/dev/CNBlogsCI-Sample</span><br><span class="line">   a51aeea..<span class="number">170</span>fbc4  master     -&gt; origin/master</span><br><span class="line">Checking out <span class="number">170</span>fbc4a as master...</span><br><span class="line">Previous HEAD position was a51aeea... test commit</span><br><span class="line">HEAD is now <span class="built_in">at</span> <span class="number">170</span>fbc4... test commit</span><br><span class="line">$ ls</span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    Directory: <span class="title">C</span>:\<span class="title">Multi</span>-<span class="title">Runner</span>\<span class="title">builds</span>\5<span class="title">ae63365</span>\0\<span class="title">dev</span>\<span class="title">CNBlogsCI</span>-<span class="title">Sample</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">Mode</span>                <span class="title">LastWriteTime</span>         <span class="title">Length</span> <span class="title">Name</span>                                                                  </span></span><br><span class="line"><span class="function">----                -------------         ------ ----                                                                  </span></span><br><span class="line"><span class="function"><span class="title">d</span>-----         5/4/2016  11:38 <span class="title">AM</span>                <span class="title">src</span>                                                                   </span></span><br><span class="line"><span class="function">-<span class="title">a</span>----         5/4/2016  11:38 <span class="title">AM</span>            319 .<span class="title">gitlab</span>-<span class="title">ci.yml</span>                                                        </span></span><br><span class="line"><span class="function">$ <span class="title">echo</span> &quot;<span class="title">Release</span> <span class="title">build</span>...&quot;</span></span><br><span class="line"><span class="function"><span class="title">Release</span> <span class="title">build</span>...</span></span><br><span class="line"><span class="function">$ <span class="title">C</span>:\<span class="title">Windows</span>\<span class="title">Microsoft.NET</span>\<span class="title">Framework64</span>\<span class="title">v4</span>.0.30319\<span class="title">msbuild.exe</span> /<span class="title">consoleloggerparameters:ErrorsOnly</span> /<span class="title">maxcpucount</span> /<span class="title">nologo</span> /<span class="title">property:Configuration</span>=<span class="title">Release</span> /<span class="title">verbosity:quiet</span> &quot;<span class="title">src</span>/<span class="title">CNBlogsCI</span>-<span class="title">Sample.sln</span>&quot;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">Build</span> <span class="title">succeeded</span></span></span><br></pre></td></tr></table></figure>

<h2 id="4-run-unit-tests"><a href="#4-run-unit-tests" class="headerlink" title="4. run unit tests"></a>4. run unit tests</h2><p>è¿™æ¬¡ä»»åŠ¡ï¼šä½¿ç”¨ CIï¼Œ run è·‘è§£å†³æ–¹æ¡ˆä¸­çš„å•å…ƒæµ‹è¯•ï¼Œå¯ä»¥æˆä¸ºè‡ªåŠ¨åŒ–æµ‹è¯•ã€‚</p>
<p>è¿™æ¬¡åŸºæœ¬ä¸Šæ²¡æœ‰ä»€ä¹ˆé—®é¢˜è§£å†³è¿‡ç¨‹ï¼Œå› ä¸º Google å®Œå…¨æœä¸åˆ°ç›¸å…³èµ„æ–™ï¼Œæ‰€ä»¥ï¼Œæˆ‘æœ€åæ˜¯æŒ‰ç…§æˆ‘çš„æƒ³æ³•å®ç°çš„ï¼ŒxUnit é™¤äº†ç”¨ VS2015 è¿›è¡Œè·‘å•å…ƒæµ‹è¯•å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç”¨å‘½ä»¤è¡Œçš„æ–¹å¼ï¼Œæ‰“å¼€ <code>cmd</code> è¾“å…¥ï¼š<code>C:\xunit.runner.console\tools\xunit.console.exe &quot;src\ClassLibrary2\bin\debug\ClassLibrary2.dll&quot;</code>ï¼Œç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">C:\<span class="title">Users</span>\<span class="title">xishuai</span>\<span class="title">Desktop</span>\<span class="title">CNBlogs</span>\<span class="title">CNBlogsCI</span>-<span class="title">Sample</span>\<span class="title">src</span>&gt; <span class="title">C</span>:\<span class="title">xunit.runner.console</span>\<span class="title">tools</span>\<span class="title">xunit.console.exe</span> &quot;<span class="title">src</span>\<span class="title">ClassLibrary2</span>\<span class="title">bin</span>\<span class="title">debug</span>\<span class="title">ClassLibrary2.dll</span>&quot;</span></span><br><span class="line"><span class="function"><span class="title">xUnit.net</span> <span class="title">Console</span> <span class="title">Runner</span> (64-<span class="title">bit</span> .<span class="title">NET</span> 4.0.30319.42000)</span></span><br><span class="line"><span class="function">  <span class="title">Discovering</span>: <span class="title">ClassLibrary2</span></span></span><br><span class="line"><span class="function">  <span class="title">Discovered</span>:  <span class="title">ClassLibrary2</span></span></span><br><span class="line"><span class="function">  <span class="title">Starting</span>:    <span class="title">ClassLibrary2</span></span></span><br><span class="line"><span class="function">    <span class="title">ClassLibrary2.Class1.Test2</span> [<span class="title">FAIL</span>]</span></span><br><span class="line"><span class="function">      <span class="title">Assert.True</span>() <span class="title">Failure</span></span></span><br><span class="line"><span class="function">      <span class="title">Expected</span>: <span class="title">True</span></span></span><br><span class="line"><span class="function">      <span class="title">Actual</span>:   <span class="title">False</span></span></span><br><span class="line"><span class="function">      <span class="title">Stack</span> <span class="title">Trace</span>:</span></span><br><span class="line"><span class="function">        <span class="title">ClassLibrary2</span>\<span class="title">Class1.cs</span>(21,0): <span class="title">at</span> <span class="title">ClassLibrary2.Class1.Test2</span>()</span></span><br><span class="line"><span class="function">  <span class="title">Finished</span>:    <span class="title">ClassLibrary2</span></span></span><br><span class="line"><span class="function">=== <span class="title">TEST</span> <span class="title">EXECUTION</span> <span class="title">SUMMARY</span> ===</span></span><br><span class="line"><span class="function">   <span class="title">ClassLibrary2</span>  <span class="title">Total</span>: 2, <span class="title">Errors</span>: 0, <span class="title">Failed</span>: 1, <span class="title">Skipped</span>: 0, <span class="title">Time</span>: 0.224<span class="title">s</span></span></span><br></pre></td></tr></table></figure>

<p>å¥½ï¼Œæ—¢ç„¶å‘½ä»¤è¡Œå¯ä»¥è·‘å•å…ƒæµ‹è¯•ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åœ¨<code>.gitlab-ci.yml</code>ä¸­æ·»åŠ è„šæœ¬é…ç½®ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">stages:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">build</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">test</span></span><br><span class="line"></span><br><span class="line"><span class="attr">before_script:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">echo</span> <span class="string">&quot;Restoring NuGet Packages...&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">C:\NuGet\nuget.exe</span> <span class="string">restore</span> <span class="string">&quot;src\CNBlogsCI-Sample.sln&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">build_job:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">build</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">echo</span> <span class="string">&quot;Release build...&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">C:\Windows\Microsoft.NET\Framework64\v4.0.30319\msbuild.exe</span> <span class="string">/consoleloggerparameters:ErrorsOnly</span> <span class="string">/maxcpucount</span> <span class="string">/nologo</span> <span class="string">/property:Configuration=Release</span> <span class="string">/verbosity:quiet</span> <span class="string">&quot;src\CNBlogsCI-Sample.sln&quot;</span></span><br><span class="line">  <span class="attr">except:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">tags</span></span><br><span class="line"></span><br><span class="line"><span class="attr">test_job:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">test</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">echo</span> <span class="string">&quot;Tests run...&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">C:\xunit.runner.console\tools\xunit.console.exe</span> <span class="string">&quot;src\ClassLibrary2\bin\debug\ClassLibrary2.dll&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">C:\xunit.runner.console\tools\xunit.console.exe</span> <span class="string">&quot;src\ClassLibrary3\bin\debug\ClassLibrary3.dll&quot;</span></span><br></pre></td></tr></table></figure>

<p>xUnit å•å…ƒæµ‹è¯•ä¸é€šè¿‡æ—¥å¿—ï¼š</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">gitlab-ci-multi-runner <span class="number">1</span>.<span class="number">1</span>.<span class="number">3</span> (a470667)</span><br><span class="line">Using Shell executor...</span><br><span class="line">Running on DESKTOP-<span class="number">2</span>P9GHDD...</span><br><span class="line">Fetching changes...</span><br><span class="line">Removing src/ClassLibrary1/bin/</span><br><span class="line">Removing src/ClassLibrary1/obj/</span><br><span class="line">Removing src/ClassLibrary2/bin/Release/</span><br><span class="line">Removing src/ClassLibrary2/obj/</span><br><span class="line">Removing src/ClassLibrary3/bin/</span><br><span class="line">Removing src/ClassLibrary3/obj/</span><br><span class="line">Removing src/packages/</span><br><span class="line">HEAD is now <span class="built_in">at</span> d176025 test commit</span><br><span class="line">Checking out d1760259 as master...</span><br><span class="line">HEAD is now <span class="built_in">at</span> d176025... test commit</span><br><span class="line">$ <span class="built_in">echo</span> &quot;Restoring NuGet Packages...&quot;</span><br><span class="line">Restoring NuGet Packages...</span><br><span class="line">$ C:\NuGet\nuget.exe <span class="built_in">restore</span> &quot;src\CNBlogsCI-Sample.sln&quot;</span><br><span class="line">Installing &#x27;xunit.abstractions <span class="number">2</span>.<span class="number">0</span>.<span class="number">0</span>&#x27;.</span><br><span class="line">Installing &#x27;xunit.assert <span class="number">2</span>.<span class="number">1</span>.<span class="number">0</span>&#x27;.</span><br><span class="line">Installing &#x27;xunit <span class="number">2</span>.<span class="number">1</span>.<span class="number">0</span>&#x27;.</span><br><span class="line">Installing &#x27;AutoMapper <span class="number">4</span>.<span class="number">2</span>.<span class="number">1</span>&#x27;.</span><br><span class="line">Successfully installed &#x27;xunit <span class="number">2</span>.<span class="number">1</span>.<span class="number">0</span>&#x27;.</span><br><span class="line">Installing &#x27;xunit.core <span class="number">2</span>.<span class="number">1</span>.<span class="number">0</span>&#x27;.</span><br><span class="line">Successfully installed &#x27;xunit.abstractions <span class="number">2</span>.<span class="number">0</span>.<span class="number">0</span>&#x27;.</span><br><span class="line">Successfully installed &#x27;xunit.core <span class="number">2</span>.<span class="number">1</span>.<span class="number">0</span>&#x27;.</span><br><span class="line">Installing &#x27;xunit.extensibility.core <span class="number">2</span>.<span class="number">1</span>.<span class="number">0</span>&#x27;.</span><br><span class="line">Successfully installed &#x27;xunit.assert <span class="number">2</span>.<span class="number">1</span>.<span class="number">0</span>&#x27;.</span><br><span class="line">Installing &#x27;xunit.extensibility.execution <span class="number">2</span>.<span class="number">1</span>.<span class="number">0</span>&#x27;.</span><br><span class="line">Installing &#x27;xunit.runner.console <span class="number">2</span>.<span class="number">1</span>.<span class="number">0</span>&#x27;.</span><br><span class="line">Successfully installed &#x27;AutoMapper <span class="number">4</span>.<span class="number">2</span>.<span class="number">1</span>&#x27;.</span><br><span class="line">Successfully installed &#x27;xunit.runner.console <span class="number">2</span>.<span class="number">1</span>.<span class="number">0</span>&#x27;.</span><br><span class="line">Successfully installed &#x27;xunit.extensibility.core <span class="number">2</span>.<span class="number">1</span>.<span class="number">0</span>&#x27;.</span><br><span class="line">Successfully installed &#x27;xunit.extensibility.execution <span class="number">2</span>.<span class="number">1</span>.<span class="number">0</span>&#x27;.</span><br><span class="line">$ <span class="built_in">echo</span> &quot;Tests run...&quot;</span><br><span class="line">Tests run...</span><br><span class="line">$ C:\xunit.runner.console\tools\xunit.console.exe &quot;src\ClassLibrary2\bin\debug\ClassLibrary2.dll&quot;</span><br><span class="line">xUnit.<span class="built_in">net</span> Console Runner (<span class="number">64</span>-bit .<span class="built_in">NET</span> <span class="number">4</span>.<span class="number">0</span>.<span class="number">30319</span>.<span class="number">42000</span>)</span><br><span class="line"><span class="function">  Discovering: <span class="title">ClassLibrary2</span></span></span><br><span class="line"><span class="function">  <span class="title">Discovered</span>:  <span class="title">ClassLibrary2</span></span></span><br><span class="line"><span class="function">  <span class="title">Starting</span>:    <span class="title">ClassLibrary2</span></span></span><br><span class="line"><span class="function">  <span class="title">Finished</span>:    <span class="title">ClassLibrary2</span></span></span><br><span class="line"><span class="function">=== <span class="title">TEST</span> <span class="title">EXECUTION</span> <span class="title">SUMMARY</span> ===</span></span><br><span class="line"><span class="function">   <span class="title">ClassLibrary2</span>  <span class="title">Total</span>: 2, <span class="title">Errors</span>: 0, <span class="title">Failed</span>: 0, <span class="title">Skipped</span>: 0, <span class="title">Time</span>: 0.179<span class="title">s</span></span></span><br><span class="line"><span class="function">$ <span class="title">C</span>:\<span class="title">xunit.runner.console</span>\<span class="title">tools</span>\<span class="title">xunit.console.exe</span> &quot;<span class="title">src</span>\<span class="title">ClassLibrary3</span>\<span class="title">bin</span>\<span class="title">debug</span>\<span class="title">ClassLibrary3.dll</span>&quot;</span></span><br><span class="line"><span class="function"><span class="title">error</span>: <span class="title">file</span> <span class="title">not</span> <span class="title">found</span>: <span class="title">src</span>\<span class="title">ClassLibrary3</span>\<span class="title">bin</span>\<span class="title">debug</span>\<span class="title">ClassLibrary3.dll</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">ERROR</span>: <span class="title">Build</span> <span class="title">failed</span>: <span class="title">exit</span> <span class="title">status</span> 1</span></span><br></pre></td></tr></table></figure>

<p>xUnit å•å…ƒæµ‹è¯•é€šè¿‡æ—¥å¿—ï¼š</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">gitlab-ci-multi-runner <span class="number">1</span>.<span class="number">1</span>.<span class="number">3</span> (a470667)</span><br><span class="line">Using Shell executor...</span><br><span class="line">Running on DESKTOP-<span class="number">2</span>P9GHDD...</span><br><span class="line">Fetching changes...</span><br><span class="line">Removing src/ClassLibrary1/bin/</span><br><span class="line">Removing src/ClassLibrary1/obj/</span><br><span class="line">Removing src/ClassLibrary2/bin/Release/</span><br><span class="line">Removing src/ClassLibrary2/obj/</span><br><span class="line">Removing src/ClassLibrary3/bin/Release/</span><br><span class="line">Removing src/ClassLibrary3/obj/</span><br><span class="line">Removing src/packages/</span><br><span class="line">HEAD is now <span class="built_in">at</span> <span class="number">2467772</span> test commit</span><br><span class="line">Checking out <span class="number">2467772</span>f as master...</span><br><span class="line">HEAD is now <span class="built_in">at</span> <span class="number">2467772</span>... test commit</span><br><span class="line">$ <span class="built_in">echo</span> &quot;Restoring NuGet Packages...&quot;</span><br><span class="line">Restoring NuGet Packages...</span><br><span class="line">$ C:\NuGet\nuget.exe <span class="built_in">restore</span> &quot;src\CNBlogsCI-Sample.sln&quot;</span><br><span class="line">Installing &#x27;AutoMapper <span class="number">4</span>.<span class="number">2</span>.<span class="number">1</span>&#x27;.</span><br><span class="line">Installing &#x27;xunit.abstractions <span class="number">2</span>.<span class="number">0</span>.<span class="number">0</span>&#x27;.</span><br><span class="line">Installing &#x27;xunit.assert <span class="number">2</span>.<span class="number">1</span>.<span class="number">0</span>&#x27;.</span><br><span class="line">Installing &#x27;xunit <span class="number">2</span>.<span class="number">1</span>.<span class="number">0</span>&#x27;.</span><br><span class="line">Successfully installed &#x27;xunit <span class="number">2</span>.<span class="number">1</span>.<span class="number">0</span>&#x27;.</span><br><span class="line">Installing &#x27;xunit.core <span class="number">2</span>.<span class="number">1</span>.<span class="number">0</span>&#x27;.</span><br><span class="line">Successfully installed &#x27;xunit.abstractions <span class="number">2</span>.<span class="number">0</span>.<span class="number">0</span>&#x27;.</span><br><span class="line">Successfully installed &#x27;xunit.core <span class="number">2</span>.<span class="number">1</span>.<span class="number">0</span>&#x27;.</span><br><span class="line">Installing &#x27;xunit.extensibility.execution <span class="number">2</span>.<span class="number">1</span>.<span class="number">0</span>&#x27;.</span><br><span class="line">Installing &#x27;xunit.extensibility.core <span class="number">2</span>.<span class="number">1</span>.<span class="number">0</span>&#x27;.</span><br><span class="line">Successfully installed &#x27;xunit.assert <span class="number">2</span>.<span class="number">1</span>.<span class="number">0</span>&#x27;.</span><br><span class="line">Installing &#x27;xunit.runner.console <span class="number">2</span>.<span class="number">1</span>.<span class="number">0</span>&#x27;.</span><br><span class="line">Successfully installed &#x27;AutoMapper <span class="number">4</span>.<span class="number">2</span>.<span class="number">1</span>&#x27;.</span><br><span class="line">Successfully installed &#x27;xunit.runner.console <span class="number">2</span>.<span class="number">1</span>.<span class="number">0</span>&#x27;.</span><br><span class="line">Successfully installed &#x27;xunit.extensibility.core <span class="number">2</span>.<span class="number">1</span>.<span class="number">0</span>&#x27;.</span><br><span class="line">Successfully installed &#x27;xunit.extensibility.execution <span class="number">2</span>.<span class="number">1</span>.<span class="number">0</span>&#x27;.</span><br><span class="line">$ <span class="built_in">echo</span> &quot;Tests run...&quot;</span><br><span class="line">Tests run...</span><br><span class="line">$ C:\xunit.runner.console\tools\xunit.console.exe &quot;src\ClassLibrary2\bin\debug\ClassLibrary2.dll&quot;</span><br><span class="line">xUnit.<span class="built_in">net</span> Console Runner (<span class="number">64</span>-bit .<span class="built_in">NET</span> <span class="number">4</span>.<span class="number">0</span>.<span class="number">30319</span>.<span class="number">42000</span>)</span><br><span class="line"><span class="function">  Discovering: <span class="title">ClassLibrary2</span></span></span><br><span class="line"><span class="function">  <span class="title">Discovered</span>:  <span class="title">ClassLibrary2</span></span></span><br><span class="line"><span class="function">  <span class="title">Starting</span>:    <span class="title">ClassLibrary2</span></span></span><br><span class="line"><span class="function">  <span class="title">Finished</span>:    <span class="title">ClassLibrary2</span></span></span><br><span class="line"><span class="function">=== <span class="title">TEST</span> <span class="title">EXECUTION</span> <span class="title">SUMMARY</span> ===</span></span><br><span class="line"><span class="function">   <span class="title">ClassLibrary2</span>  <span class="title">Total</span>: 2, <span class="title">Errors</span>: 0, <span class="title">Failed</span>: 0, <span class="title">Skipped</span>: 0, <span class="title">Time</span>: 0.194<span class="title">s</span></span></span><br><span class="line"><span class="function">$ <span class="title">C</span>:\<span class="title">xunit.runner.console</span>\<span class="title">tools</span>\<span class="title">xunit.console.exe</span> &quot;<span class="title">src</span>\<span class="title">ClassLibrary3</span>\<span class="title">bin</span>\<span class="title">debug</span>\<span class="title">ClassLibrary3.dll</span>&quot;</span></span><br><span class="line"><span class="function"><span class="title">xUnit.net</span> <span class="title">Console</span> <span class="title">Runner</span> (64-<span class="title">bit</span> .<span class="title">NET</span> 4.0.30319.42000)</span></span><br><span class="line"><span class="function">  <span class="title">Discovering</span>: <span class="title">ClassLibrary3</span></span></span><br><span class="line"><span class="function">  <span class="title">Discovered</span>:  <span class="title">ClassLibrary3</span></span></span><br><span class="line"><span class="function">  <span class="title">Starting</span>:    <span class="title">ClassLibrary3</span></span></span><br><span class="line"><span class="function">  <span class="title">Finished</span>:    <span class="title">ClassLibrary3</span></span></span><br><span class="line"><span class="function">=== <span class="title">TEST</span> <span class="title">EXECUTION</span> <span class="title">SUMMARY</span> ===</span></span><br><span class="line"><span class="function">   <span class="title">ClassLibrary3</span>  <span class="title">Total</span>: 1, <span class="title">Errors</span>: 0, <span class="title">Failed</span>: 0, <span class="title">Skipped</span>: 0, <span class="title">Time</span>: 0.184<span class="title">s</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">Build</span> <span class="title">succeeded</span></span></span><br></pre></td></tr></table></figure>

<p>åŸºæœ¬ä¸Šå®ç°äº†æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœï¼Œä½†è¿™ç§å®ç°æ–¹å¼æœ‰ä¸¤ä¸ªä¸å¥½çš„åœ°æ–¹ï¼š</p>
<ul>
<li>éœ€è¦å°†å•å…ƒæµ‹è¯•çš„ <code>*.dll</code> æ–‡ä»¶ä¸Šä¼ åˆ° git èµ„æºåº“ã€‚</li>
<li>æ¯å¢åŠ ä¸€ä¸ªå•å…ƒæµ‹è¯•é¡¹ç›®ï¼Œå°±å¿…é¡»åœ¨<code>.gitlab-ci.yml</code>ä¸­æ·»åŠ ä¸€æ®µè„šæœ¬ã€‚</li>
</ul>
<p>æˆ‘ä¸ªäººè§‰å¾— CI ä¸­çš„è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œè‚¯å®šä¸æ˜¯åƒæˆ‘è¿™æ ·æçš„ï¼Œä½†å®åœ¨æ‰¾ä¸åˆ°ç›¸å…³èµ„æ–™ï¼Œå¦‚æœå¤§å®¶çŸ¥æ‚‰ï¼Œè¿˜è¯·å‘ŠçŸ¥ï¼Œæ„Ÿè°¢ï½</p>
<p>å¦å¤–ï¼Œå¦‚æœæ˜¯ ASP.NET 5 é¡¹ç›®ï¼Œè¿›è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•é…ç½®ï¼Œä¼šéå¸¸ç®€å•ï¼Œé…ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">test:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">test</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">echo</span> <span class="string">&quot;Tests run...&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">dnx</span> <span class="string">test</span> <span class="comment">#æˆ–è€… dotnet test</span></span><br></pre></td></tr></table></figure>

<h2 id="5-configue-gitlab-ci-yml"><a href="#5-configue-gitlab-ci-yml" class="headerlink" title="5. configue .gitlab-ci.yml"></a>5. configue .gitlab-ci.yml</h2><p><code>.gitlab-ci.yml</code>å®˜æ–¹èµ„æ–™ï¼š<a target="_blank" rel="noopener" href="http://doc.gitlab.com/ee/ci/yaml/README.html">http://doc.gitlab.com/ee/ci/yaml/README.html</a></p>
<p>å…¶ä»–ç¤ºä¾‹ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://stackoverflow.com/questions/32964953/gitlab-ci-and-msbuild-with-tests">http://stackoverflow.com/questions/32964953/gitlab-ci-and-msbuild-with-tests</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/CWISoftware/accounts/blob/master/.gitlab-ci.yml">https://github.com/CWISoftware/accounts/blob/master/.gitlab-ci.yml</a></li>
<li><a target="_blank" rel="noopener" href="http://www.timtilberg.com/tag/gitlab/">http://www.timtilberg.com/tag/gitlab/</a></li>
<li><a target="_blank" rel="noopener" href="http://doc.gitlab.com/ee/ci/yaml/README.html#stages">http://doc.gitlab.com/ee/ci/yaml/README.html#stages</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/travis-ci/travis-ci/issues/5210">https://github.com/travis-ci/travis-ci/issues/5210</a></li>
</ul>
<p><code>.gitlab-ci.yml</code>ä¸­çš„é…ç½®è¯´æ˜ï¼Œä¸Šé¢çš„å®˜æ–¹èµ„æ–™ä»‹ç»çš„éå¸¸è¯¦ç»†ï¼Œä¸‹é¢æˆ‘å†ç®€å•ä»‹ç»ä¸‹ï¼Œå°±ç”¨æˆ‘è¿™æ¬¡éƒ¨ç½² CI å®Œå–„åçš„<code>.gitlab-ci.yml</code>é…ç½®ï¼š</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">stages:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">build</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">test</span></span><br><span class="line"></span><br><span class="line"><span class="attr">before_script:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">echo</span> <span class="string">&quot;Restoring NuGet Packages...&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">C:\NuGet\nuget.exe</span> <span class="string">restore</span> <span class="string">&quot;src\CNBlogsCI-Sample.sln&quot;</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line"></span><br><span class="line"><span class="attr">build_job:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">build</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">echo</span> <span class="string">&quot;Release build...&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">C:\Windows\Microsoft.NET\Framework64\v4.0.30319\msbuild.exe</span> <span class="string">/consoleloggerparameters:ErrorsOnly</span> <span class="string">/maxcpucount</span> <span class="string">/nologo</span> <span class="string">/property:Configuration=Release</span> <span class="string">/verbosity:quiet</span> <span class="string">&quot;src\CNBlogsCI-Sample.sln&quot;</span></span><br><span class="line">  <span class="attr">except:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">tags</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line"></span><br><span class="line"><span class="attr">test_job:</span></span><br><span class="line">  <span class="attr">stage:</span> <span class="string">test</span></span><br><span class="line">  <span class="attr">script:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">echo</span> <span class="string">&quot;Tests run...&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">C:\xunit.runner.console\tools\xunit.console.exe</span> <span class="string">&quot;src\ClassLibrary2\bin\debug\ClassLibrary2.dll&quot;</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">C:\xunit.runner.console\tools\xunit.console.exe</span> <span class="string">&quot;src\ClassLibrary3\bin\debug\ClassLibrary3.dll&quot;</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">master</span></span><br></pre></td></tr></table></figure>

<p><code>stage</code>ç¿»è¯‘ä¸º<strong>é˜¶æ®µ</strong>çš„æ„æ€ï¼Œåœ¨<strong>æ„å»º</strong>çš„è¿‡ç¨‹ä¸­ï¼Œå¿…é¡»è¦æœ‰ä¸€ä¸ªå…ˆåé¡ºåºï¼Œæœ€ä¸Šé¢çš„<code>stages</code>é…ç½®æ„æ€æ˜¯ï¼Œå…ˆæ„å»ºé˜¶æ®µä¸º<code>build</code>çš„<code>job</code>ï¼Œç„¶åå†æ„å»ºé˜¶æ®µä¸º<code>test</code>çš„<code>job</code>ï¼Œä¸‹é¢<code>build_job</code>å’Œ<code>test_job</code>éƒ½æ˜¯<code>job</code>ï¼Œå¦‚æœä¸é…ç½®<code>stages</code>ï¼Œé»˜è®¤ä¸ºï¼š</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">stages:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">build</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">test</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">deploy</span></span><br></pre></td></tr></table></figure>

<p><code>before_script</code>çš„æ„æ€æ˜¯ï¼Œæ‰§è¡Œåœ¨æ‰€æœ‰çš„<code>job</code>ä¹‹å‰çš„è„šæœ¬ï¼Œæ¯”å¦‚æ„å»º<code>build_job</code>å’Œ<code>test_job</code>éƒ½å…ˆæ‰§è¡Œ<code>before_script</code>ï¼Œ<code>build_job</code>å’Œ<code>test_job</code>ä¸­çš„<code>stage</code>é…ç½®ï¼Œæ„æ€æ˜¯æ­¤<code>job</code>å±äºå“ªä¸ª<code>stage</code>ï¼Œè¿™ä¸ª<code>stage</code>å°±æ˜¯æœ€ä¸Šé¢çš„<code>stages</code>é…ç½®ï¼Œé™¤äº†é»˜è®¤çš„<code>build</code>,<code>test</code>å’Œ<code>deploy</code>ï¼Œä½ ä¹Ÿå¯ä»¥æ·»åŠ è‡ªå®šä¹‰çš„<code>stage</code>ï¼Œå¦å¤–ï¼Œå¦‚æœ<code>job</code>ä¸æ·»åŠ <code>stage</code>é…ç½®ï¼Œé»˜è®¤é…ç½®ä¸º<code>test</code>ï¼Œæ¯”å¦‚ä¸Šé¢çš„<code>test_job</code>ï¼Œå°±å¯ä»¥çœç•¥<code>stage: test</code>é…ç½®ã€‚</p>
<p>å¦å¤–ï¼Œ<code>job</code>è¿˜æœ‰ä¸€ä¸ª<code>when: on_failure/on_success /always </code>é…ç½®ï¼Œå¦‚æœæˆ‘ä»¬å¯¹<code>job</code>è¿›è¡Œäº†<code>stage</code>é…ç½®ï¼Œé»˜è®¤éƒ½ä¼šæ˜¯<code>when: on_success</code>ï¼š</p>
<p><img src="https://images2015.cnblogs.com/blog/435188/201605/435188-20160505213235279-417659233.png" alt="img"></p>
<p><code>only - master</code>çš„æ„æ€æ˜¯ï¼Œåªæœ‰``master<code>åˆ†æ”¯æ‰ä¼šè¿›è¡Œæ„å»ºï¼Œ</code>script`çš„æ„æ€å¾ˆæ˜äº†ï¼Œå°±æ˜¯è¦æ‰§è¡Œçš„è„šæœ¬å‘½åã€‚</p>
<h2 id="6-configue-build-status-badge-image"><a href="#6-configue-build-status-badge-image" class="headerlink" title="6. configue build status badge image"></a>6. configue build status badge image</h2><p>æ„å»ºçŠ¶æ€å¾½ç« ï¼Œå°±æ˜¯æˆ‘ä»¬å¹³å¸¸åœ¨ Github é¡¹ç›®ä¸­çœ‹åˆ°æ„å»ºå›¾æ ‡ï¼Œæœ‰<code>pass</code>å’Œ<code>failing</code>ç­‰ç­‰ã€‚</p>
<p>Gitlab CI ä¸­çš„æ•™ç¨‹ <a target="_blank" rel="noopener" href="http://doc.gitlab.com/ce/ci/quick_start/README.html">builds-badge</a> çœŸçš„å¾ˆå‘çˆ¹ï¼Œæ€ä¹ˆè¯•éƒ½ä¸è¡Œï¼Œåæ¥æ— æ„é—´çœ‹åˆ° Gitlab é¡¹ç›®çš„ä¸€ä¸ªé€‰é¡¹ <strong>Settings &gt; Badges</strong>ï¼š</p>
<p><img src="https://images2015.cnblogs.com/blog/435188/201605/435188-20160505214934794-2100519539.png" alt="img"></p>
<p>å¤åˆ¶ä¸Šé¢çš„ä»£ç ï¼Œç„¶åæ·»åŠ åœ¨<code>README.md</code>æ–‡ä»¶ä¸­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[![build status](https://gitlab.com/dev/CNBlogsCI-Sample/badges/master/build.svg)](https://gitlab.com/dev/CNBlogsCI-Sample/commits/master)</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·åœ¨<code>commit``bulid</code>çš„æ—¶å€™ï¼Œå°±ä¼šåŠ¨æ€çš„æ˜¾ç¤º<code>bulid</code>çš„è¿‡ç¨‹å’Œç»“æœï¼Œå¹¶ä¸”æ˜¯å›¾ç‰‡æ˜¾ç¤ºã€‚</p>
<p><img src="https://images2015.cnblogs.com/blog/435188/201605/435188-20160505215133466-114072506.png" alt="img"></p>
<p>Gitlab éƒ¨ç½²å¥½ CI ä¹‹åï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œåœ¨é¡¹ç›®ä¸­éšå¤„å¯è§è¿™æ ·çš„å›¾æ ‡ï¼š</p>
<p><img src="https://images2015.cnblogs.com/blog/435188/201605/435188-20160505215527560-1180463408.png" alt="img"></p>
<hr>
<p>è¿™ç¯‡åšæ–‡æ²¡æœ‰ä»€ä¹ˆé˜…è¯»ä»·å€¼ï¼Œå› ä¸ºéƒ½æ˜¯é›¶é›¶ç¢ç¢çš„é—®é¢˜å’Œè§£å†³çºªå½•ï¼Œæ²¡æœ‰ä»€ä¹ˆå¯è¯»æ€§ï¼Œå¦‚æœä½ èƒ½é˜…è¯»åˆ°è¿™ï¼Œæˆ‘çœŸçš„ä¼šå¾ˆæ„ŸåŠ¨ã€‚</p>
<p>åˆ†äº«æ˜¯æœ‰ä»·å€¼çš„ä¸€ä»¶äº‹ï¼Œå¦‚æœå›­å‹åœ¨é‡åˆ°ç›¸åŒé—®é¢˜çš„æ—¶å€™ï¼Œå¯ä»¥ Google åˆ°è¿™ç¯‡åšæ–‡ï¼Œé‚£å†™è¿™ç¯‡åšæ–‡ä¹Ÿå°±å€¼äº†ğŸ˜ã€‚</p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">


</div>



	<div class="article-share" id="share">
	
	  <div data-url="https://knightark.github.io/2020/12/22/%E5%8A%88%E8%8D%86%E6%96%A9%E6%A3%98%EF%BC%9AGitlab%20%E9%83%A8%E7%BD%B2%20CI%20%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90/" data-title="åŠˆè†æ–©æ£˜ï¼šGitlab éƒ¨ç½² CI æŒç»­é›†æˆ | ä¸ªäººåšå®¢" data-tsina="" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2020/12/22/WPFä¸‰ç»´ç«‹ä½“æ•ˆæœ3D/" title="WPFä¸‰ç»´ç«‹ä½“æ•ˆæœ3D">
  <strong>ä¸Šä¸€ç¯‡ï¼š</strong><br/>
  <span>
  WPFä¸‰ç»´ç«‹ä½“æ•ˆæœ3D</span>
</a>
</div>


<div class="next">
<a href="/2020/12/18/Nginxçš„ä»£ç†é…ç½®/"  title="Nginxçš„ä»£ç†é…ç½®">
 <strong>ä¸‹ä¸€ç¯‡ï¼š</strong><br/> 
 <span>Nginxçš„ä»£ç†é…ç½®
</span>
</a>
</div>

</nav>

	



</div>  
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">Contents</strong>
 
 <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8A%88%E8%8D%86%E6%96%A9%E6%A3%98%EF%BC%9AGitlab-%E9%83%A8%E7%BD%B2-CI-%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90"><span class="toc-number">1.</span> <span class="toc-text">     åŠˆè†æ–©æ£˜ï¼šGitlab éƒ¨ç½² CI æŒç»­é›†æˆ        </span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-install-configue-gitlab-ci-multi-runner"><span class="toc-number">1.1.</span> <span class="toc-text">1. install configue gitlab-ci-multi-runner</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-restore-nuget-packages"><span class="toc-number">1.2.</span> <span class="toc-text">2. restore nuget packages</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-build-sln"><span class="toc-number">1.3.</span> <span class="toc-text">3. build *.sln</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-run-unit-tests"><span class="toc-number">1.4.</span> <span class="toc-text">4. run unit tests</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-configue-gitlab-ci-yml"><span class="toc-number">1.5.</span> <span class="toc-text">5. configue .gitlab-ci.yml</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-configue-build-status-badge-image"><span class="toc-number">1.6.</span> <span class="toc-text">6. configue build status badge image</span></a></li></ol></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  


  
<div class="categorieslist">
	<p class="asidetitle">Categories</p>
		<ul>
		
		  
			<li><a href="/categories/C/" title="C#">C#<sup>21</sup></a></li>
		  
		
		  
			<li><a href="/categories/CI-CD/" title="CI/CD">CI/CD<sup>9</sup></a></li>
		  
		
		  
			<li><a href="/categories/DDD/" title="DDD">DDD<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/JAVA/" title="JAVA">JAVA<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/WPF/" title="WPF">WPF<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/linux/" title="linux">linux<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/linx/" title="linx">linx<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/nodejs/" title="nodejs">nodejs<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/äº§å“/" title="äº§å“">äº§å“<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/å‰ç«¯/" title="å‰ç«¯">å‰ç«¯<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/å¤§æ•°æ®/" title="å¤§æ•°æ®">å¤§æ•°æ®<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/å·¥å…·/" title="å·¥å…·">å·¥å…·<sup>5</sup></a></li>
		  
		
		  
			<li><a href="/categories/è£…æœº/" title="è£…æœº">è£…æœº<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/è½¯ä»¶/" title="è½¯ä»¶">è½¯ä»¶<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/è½¯ä»¶å¼€å‘è¿‡ç¨‹/" title="è½¯ä»¶å¼€å‘è¿‡ç¨‹">è½¯ä»¶å¼€å‘è¿‡ç¨‹<sup>1</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/C/" title="C#">C#<sup>22</sup></a></li>
			
		
			
				<li><a href="/tags/linux/" title="linux">linux<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/WPF/" title="WPF">WPF<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/å·¥å…·/" title="å·¥å…·">å·¥å…·<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/docker/" title="docker">docker<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/dotnetcore/" title="dotnetcore">dotnetcore<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/é€šä¿¡/" title="é€šä¿¡">é€šä¿¡<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/docker-compose/" title="docker-compose">docker-compose<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/MVVM/" title="MVVM">MVVM<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/MVVM-light/" title="MVVM light">MVVM light<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/ci-cd/" title="ci/cd">ci/cd<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Docker/" title="Docker">Docker<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/CI-CD/" title="CI/CD">CI/CD<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/reactor/" title="reactor">reactor<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/chart/" title="chart">chart<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/SoA/" title="SoA">SoA<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/ä»£ç†/" title="ä»£ç†">ä»£ç†<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/nginx/" title="nginx">nginx<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/ç”Ÿäº§è€…æ¶ˆè´¹è€…/" title="ç”Ÿäº§è€…æ¶ˆè´¹è€…">ç”Ÿäº§è€…æ¶ˆè´¹è€…<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/æ¶ˆæ¯é€šä¿¡/" title="æ¶ˆæ¯é€šä¿¡">æ¶ˆæ¯é€šä¿¡<sup>2</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
        
    </ul>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Knight Ark. <br/>
			This is my blog.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/2176287895" target="_blank" class="icon-weibo" title="å¾®åš"></a>
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> Â© 2021 
		
		<a href="/about" target="_blank" title="knightark">knightark</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="å¾®ä¿¡"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="äººäºº"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="å¾®åš"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>











<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
